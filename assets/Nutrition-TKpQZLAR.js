import{j as e,r as d,R as K}from"./vendor-react-b1n3RH4y.js";import{S as ae,a as te,b as re,c as le,d as ne}from"./select-E4jjsNR2.js";import{d as I,L as z,I as P,C as T,a as E,b as R,c as D,e as Y,B as p}from"./index-Dh6OigyZ.js";import{T as ce}from"./vendor-firebase-BgMWbdUj.js";import{S as pe,a as je,a1 as _,a2 as oe,a3 as G,a4 as ie,$ as de,a5 as W,a6 as ge,a7 as Ne,a8 as ve,a9 as be,n as we,aa as ye,B as Se,z as Ce,H as J,ab as Fe,ac as ke,ad as me,ae as Te,af as De,ag as ue,ah as Ie,ai as Ae}from"./vendor-26V6_GIG.js";import{a as ze,b as Me,c as Le,g as qe,d as H,u as Ee}from"./useNutritionEntry-SibYRlZB.js";import{u as Re}from"./useDebounce-C8AyE5Jv.js";import"./firestore-BVp1zGt2.js";const $e=je("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function X({className:s,variant:t,asChild:a=!1,...r}){const o=a?pe:"span";return e.jsx(o,{"data-slot":"badge",className:I($e({variant:t}),s),...r})}const Oe=({message:s,className:t})=>s?e.jsxs("div",{className:I("flex items-center gap-2 text-destructive text-sm",t),children:[e.jsx(_,{className:"h-4 w-4"}),e.jsx("span",{children:s})]}):null;function k({className:s,...t}){return e.jsx("div",{"data-slot":"skeleton",className:I("bg-accent animate-pulse rounded-md",s),...t})}const Pe=[{value:"breakfast",label:"Breakfast"},{value:"lunch",label:"Lunch"},{value:"dinner",label:"Dinner"},{value:"snack",label:"Snack"},{value:"other",label:"Other"}],_e=({name:s,time:t,onNameChange:a,onTimeChange:r})=>e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs(q,{children:[e.jsx(z,{htmlFor:"meal-name",children:"Meal Type"}),e.jsxs(ae,{value:s,onValueChange:a,children:[e.jsx(te,{id:"meal-name",className:"max-w-[180px]",children:e.jsx(re,{placeholder:"Select meal type"})}),e.jsx(le,{children:Pe.map(o=>e.jsx(ne,{value:o.value,children:o.label},o.value))})]})]}),e.jsxs(q,{children:[e.jsx(z,{htmlFor:"meal-time",children:"Time"}),e.jsx(P,{id:"meal-time",type:"time",value:t,onChange:r,className:"max-w-[180px]"})]})]}),Be=({onSubmit:s,onCancel:t,initialMeal:a,isEditing:r=!1})=>{const[o,n]=d.useState((a==null?void 0:a.name)||""),[i,m]=d.useState((a==null?void 0:a.time)||ce.now()),[u,N]=d.useState({mealName:""}),[b,l]=d.useState(!1),c=()=>{const x={mealName:""};let v=!0;return o||(x.mealName="Meal type is required",v=!1),N(x),v},h=async x=>{if(x.preventDefault(),!!c())try{l(!0),await s({name:o,time:i})}catch(v){console.error("Error submitting meal form:",v)}finally{l(!1)}},j=x=>{n(x),x&&N(v=>({...v,mealName:""}))},g=x=>{m(Me(x.target.value))};return e.jsxs(T,{className:"w-full",children:[e.jsx(E,{children:e.jsxs(R,{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"h-5 w-5"}),r?"Edit Meal":"Add New Meal"]})}),e.jsxs("form",{onSubmit:h,children:[e.jsxs(D,{className:"space-y-4",children:[e.jsx(_e,{name:o,time:ze(i),onNameChange:j,onTimeChange:g}),u.mealName&&e.jsx(Oe,{message:u.mealName})]}),e.jsxs(Y,{className:"flex justify-end gap-2 border-t pt-4 mt-1",children:[e.jsx(p,{type:"button",variant:"outline",onClick:t,disabled:b,children:"Cancel"}),e.jsx(p,{type:"submit",disabled:b,children:b?"Saving...":r?"Save Changes":"Save Meal"})]})]})]})},Ue=s=>{const t={name:"",quantity:"",calories:"",protein:"",carbs:"",fat:""};let a=!0;return s.name.trim()||(t.name="Food name is required",a=!1),s.quantity<=0&&(t.quantity="Quantity must be greater than 0",a=!1),s.calories<0&&(t.calories="Calories cannot be negative",a=!1),s.protein<0&&(t.protein="Protein cannot be negative",a=!1),s.carbs<0&&(t.carbs="Carbs cannot be negative",a=!1),s.fat<0&&(t.fat="Fat cannot be negative",a=!1),{isValid:a,newErrors:t}},ee="aGILeRnIJ3bHhfVWbBagI6fbyRwqbzDGOf5x1FB3",se="https://api.nal.usda.gov/fdc/v1",A={calories:1008,protein:1003,carbs:1005,fat:1004,fiber:1079,sugar:2e3,sodium:1093},Z={searchFoods:async(s,t=20)=>{try{const a=await fetch(`${se}/foods/search?api_key=${ee}&query=${encodeURIComponent(s)}&pageSize=${t}`);if(!a.ok)throw new Error(`USDA API error: ${a.status}`);return(await a.json()).foods||[]}catch(a){throw console.error("Error searching foods:",a),a}},getFoodDetails:async s=>{try{const t=await fetch(`${se}/food/${s}?api_key=${ee}`);if(!t.ok)throw new Error(`USDA API error: ${t.status}`);return await t.json()}catch(t){throw console.error(`Error getting food details for ID ${s}:`,t),t}},extractNutrients:s=>{const t={calories:0,protein:0,carbs:0,fat:0,fiber:0,sugar:0,sodium:0};return s.foodNutrients.forEach(a=>{switch(a.nutrientId){case A.calories:t.calories=a.value;break;case A.protein:t.protein=a.value;break;case A.carbs:t.carbs=a.value;break;case A.fat:t.fat=a.value;break;case A.fiber:t.fiber=a.value;break;case A.sugar:t.sugar=a.value;break;case A.sodium:t.sodium=a.value;break}}),t}},Ke=[{value:"g",label:"grams (g)"},{value:"ml",label:"milliliters (ml)"}],Qe=[{id:"calories",label:"Calories",placeholder:"165",unit:""},{id:"protein",label:"Protein",placeholder:"31",unit:"g"},{id:"carbs",label:"Carbs",placeholder:"0",unit:"g"},{id:"fat",label:"Fat",placeholder:"3.6",unit:"g"}],He=({onSubmit:s,onCancel:t,initValues:a})=>{const[r,o]=d.useState({name:(a==null?void 0:a.name)||"",quantity:(a==null?void 0:a.quantity)||100,calories:(a==null?void 0:a.calories)||0,protein:(a==null?void 0:a.protein)||0,carbs:(a==null?void 0:a.carbs)||0,fat:(a==null?void 0:a.fat)||0,unit:(a==null?void 0:a.unit)||"g"}),[n,i]=d.useState({name:"",quantity:"",calories:"",protein:"",carbs:"",fat:""}),m=l=>{const c=Z.extractNutrients(l);o({...r,name:l.description,quantity:100,calories:Math.round(c.calories||0),protein:Math.round(c.protein||0),carbs:Math.round(c.carbs||0),fat:Math.round(c.fat||0)}),i({name:"",quantity:"",calories:"",protein:"",carbs:"",fat:""})},u=l=>{const{id:c,value:h}=l.target,j=c.replace("food-",""),x=["quantity","calories","protein","carbs","fat"].includes(j)?parseFloat(h)||0:h;o(v=>({...v,[j]:x})),n[j]&&i(v=>({...v,[j]:""}))},N=l=>{o(c=>({...c,unit:l}))},b=l=>{l.preventDefault();const c=Ue(r);i(c.newErrors),c.isValid&&s(r)};return e.jsxs("form",{onSubmit:b,className:"space-y-4",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx(z,{className:"text-sm font-medium block mb-2",children:"Search USDA Food Database"}),e.jsx(Ze,{onSelectFood:m,buttonLabel:"Select",autoFocus:!a}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Search for foods to automatically fill nutrition information"})]}),e.jsxs(q,{children:[e.jsx(z,{htmlFor:"food-name",className:"text-sm font-medium",children:"Food Name"}),e.jsx(P,{id:"food-name",placeholder:"e.g., Chicken Breast",value:r.name,onChange:u,className:n.name?"border-destructive":""}),n.name&&e.jsxs("div",{className:"flex items-center mt-1 text-destructive text-xs",children:[e.jsx(_,{className:"h-3 w-3 mr-1"}),e.jsx("span",{children:n.name})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs(q,{children:[e.jsx(z,{htmlFor:"food-quantity",className:"text-sm font-medium",children:"Quantity"}),e.jsx(P,{id:"food-quantity",type:"number",placeholder:"100",value:r.quantity===0?"":r.quantity,onChange:u,min:"0",step:"any",className:n.quantity?"border-destructive":""}),n.quantity&&e.jsxs("div",{className:"flex items-center mt-1 text-destructive text-xs",children:[e.jsx(_,{className:"h-3 w-3 mr-1"}),e.jsx("span",{children:n.quantity})]})]}),e.jsxs(q,{children:[e.jsx(z,{htmlFor:"food-unit",className:"text-sm font-medium",children:"Unit"}),e.jsxs(ae,{value:r.unit,onValueChange:N,children:[e.jsx(te,{id:"food-unit",children:e.jsx(re,{placeholder:"Select unit"})}),e.jsx(le,{children:Ke.map(l=>e.jsx(ne,{value:l.value,children:l.label},l.value))})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium mb-2",children:"Nutrition Information"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:Qe.map(l=>e.jsxs(q,{children:[e.jsxs(z,{htmlFor:`food-${l.id}`,className:"text-sm font-medium",children:[l.label,l.unit?` (${l.unit})`:""]}),e.jsx(P,{id:`food-${l.id}`,type:"number",placeholder:l.placeholder,value:r[l.id]===0?"":r[l.id],onChange:u,min:"0",step:"any",className:n[l.id]?"border-destructive":""}),n[l.id]&&e.jsxs("div",{className:"flex items-center mt-1 text-destructive text-xs",children:[e.jsx(_,{className:"h-3 w-3 mr-1"}),e.jsx("span",{children:n[l.id]})]})]},l.id))})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx(p,{type:"button",variant:"outline",size:"sm",onClick:t,children:"Cancel"}),e.jsxs(p,{type:"submit",size:"sm",children:[a?"Update":"Add"," Food Item"]})]})]})},Ge=({onSubmit:s,onCancel:t,initialMeal:a,isEditing:r=!1})=>{const[o,n]=d.useState("meal"),[i,m]=d.useState({name:(a==null?void 0:a.name)||"",time:(a==null?void 0:a.time)||ce.now()}),[u,N]=d.useState((a==null?void 0:a.foods)||[]),[b,l]=d.useState(!1),[c,h]=d.useState(null),[j,g]=d.useState(null),[x,v]=d.useState(!1),M=async f=>{m(f),n("food")},$=()=>{l(!0),h(null),g(null)},O=f=>{l(!0),h(u[f]),g(f)},S=f=>{N(w=>w.filter((V,Q)=>Q!==f))},L=f=>{N(j!==null?w=>w.map((V,Q)=>Q===j?f:V):w=>[...w,f]),l(!1),h(null),g(null)},B=()=>{l(!1),h(null),g(null)},U=()=>{n("meal")},C=async()=>{if(!(!i||u.length===0)){v(!0);try{const f={id:(a==null?void 0:a.id)||`meal-${Date.now()}`,name:i.name,time:i.time,foods:u};await s(f)}catch(f){console.error("Error submitting meal:",f)}finally{v(!1)}}},F=u.reduce((f,w)=>(f.calories+=w.calories*w.quantity/100,f.protein+=w.protein*w.quantity/100,f.carbs+=w.carbs*w.quantity/100,f.fat+=w.fat*w.quantity/100,f),{calories:0,protein:0,carbs:0,fat:0});return e.jsxs(T,{className:"w-full",children:[e.jsx(E,{children:e.jsxs(R,{children:[r?"Edit Meal":"Add New Meal",o==="food"&&e.jsxs(X,{className:"ml-2",children:[u.length," items"]})]})}),e.jsx(D,{children:o==="meal"?e.jsx(Be,{onSubmit:M,onCancel:t,initialMeal:i,isEditing:r}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-muted p-3 rounded-md flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium capitalize",children:i.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(i.time.toMillis()).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),e.jsxs(p,{variant:"outline",size:"sm",onClick:U,children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Edit"]})]}),b?e.jsx("div",{className:"border rounded-lg p-4",children:e.jsx(He,{onSubmit:L,onCancel:B,initValues:c||void 0})}):e.jsxs("div",{className:"space-y-3",children:[u.length>0&&e.jsxs("div",{className:"space-y-2",children:[u.map((f,w)=>e.jsxs("div",{className:"border rounded-lg p-3 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:f.name}),e.jsxs("div",{className:"flex gap-3 text-sm text-muted-foreground",children:[e.jsxs("span",{children:[f.quantity," ",f.unit]}),e.jsxs("span",{children:[f.calories," kcal"]}),e.jsxs("span",{children:[f.protein,"g protein"]})]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>O(w),className:"h-8 w-8 p-0",children:e.jsx(G,{className:"h-4 w-4"})}),e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>S(w),className:"h-8 w-8 p-0 text-destructive hover:bg-destructive/10",children:e.jsx(ie,{className:"h-4 w-4"})})]})]},w)),e.jsxs("div",{className:"bg-secondary/40 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium text-sm",children:"Total calories:"}),e.jsxs("span",{className:"font-medium text-sm",children:[F.calories," kcal"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium text-sm",children:"Total protein:"}),e.jsxs("span",{className:"font-medium text-sm",children:[F.protein,"g"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium text-sm",children:"Total carbs:"}),e.jsxs("span",{className:"font-medium text-sm",children:[F.carbs,"g"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium text-sm",children:"Total fat:"}),e.jsxs("span",{className:"font-medium text-sm",children:[F.fat,"g"]})]})]})]}),e.jsxs(p,{variant:"outline",className:"w-full",onClick:$,children:[e.jsx(de,{className:"h-4 w-4 mr-2"}),u.length?"Add Another Food":"Add Food Item"]})]})]})}),o==="food"&&!b&&e.jsxs(Y,{className:"border-t pt-4 flex justify-between",children:[e.jsxs(p,{variant:"ghost",onClick:t,disabled:x,children:[e.jsx(W,{className:"h-4 w-4 mr-2"}),"Cancel"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(p,{variant:"outline",onClick:U,disabled:x,children:[e.jsx(ge,{className:"h-4 w-4 mr-2"}),"Back"]}),e.jsxs(p,{onClick:C,disabled:u.length===0||x,children:[e.jsx(Ne,{className:"h-4 w-4 mr-2"}),x?"Saving...":r?"Update Meal":"Add Meal"]})]})]})]})},y=(s,t)=>s.reduce((a,r)=>a+r.foods.reduce((o,n)=>o+n[t]*(n.quantity/100),0),0),Ye=({meal:s,className:t,onEdit:a,onDelete:r})=>{const[o,n]=d.useState(!1),i=y([s],"calories"),m=y([s],"protein"),u=s.time?new Date(s.time.toDate()).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"No time set",N=()=>n(b=>!b);return e.jsxs(T,{className:I("overflow-hidden",t),children:[e.jsx(E,{className:"py-3 px-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(R,{className:"text-base capitalize flex items-center",children:[s.name,e.jsx(X,{variant:"outline",className:"ml-2 font-normal text-xs",children:u})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[a&&e.jsxs(p,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:()=>a(s),children:[e.jsx(ve,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Edit"})]}),r&&e.jsxs(p,{variant:"ghost",size:"sm",onClick:r,className:"h-8 w-8 p-0 text-destructive hover:text-destructive hover:bg-destructive/10",children:[e.jsx(ie,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Delete"})]}),e.jsxs(p,{variant:"ghost",size:"sm",onClick:N,className:"h-8 w-8 p-0 ml-1",children:[o?e.jsx(be,{className:"h-4 w-4"}):e.jsx(we,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:o?"Collapse":"Expand"})]})]})]})}),e.jsxs(D,{className:"px-4 pb-4 pt-0",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[e.jsxs("div",{className:"flex items-center text-muted-foreground",children:[e.jsx(ye,{className:"h-3.5 w-3.5 mr-1.5"}),e.jsx("span",{children:u})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("span",{className:"font-medium",children:[i," kcal"]}),e.jsxs("span",{className:"font-medium",children:[m,"g protein"]})]})]}),o&&s.foods.length>0&&e.jsx("div",{className:"pt-2 mt-2 border-t",children:e.jsx(Ve,{foods:s.foods})}),o&&s.foods.length===0&&e.jsx("div",{className:"py-3 text-center bg-muted/30 rounded-md mt-2",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"No food items in this meal"})}),!o&&s.foods.length>0&&e.jsxs(p,{variant:"ghost",size:"sm",onClick:N,className:"w-full mt-1 border border-dashed text-muted-foreground",children:["Show ",s.foods.length," food item",s.foods.length>1?"s":""]}),o&&s.foods.length>0&&e.jsx(p,{variant:"ghost",size:"sm",onClick:N,className:"w-full mt-1 border border-dashed text-muted-foreground",children:"Hide"})]})]})},We=({selectedDate:s,onDateChange:t})=>{const a=i=>{const m={weekday:"short",month:"short",day:"numeric"};return i.toLocaleDateString("en-US",m)},r=()=>{const i=new Date(s);i.setDate(s.getDate()-1),t(i)},o=()=>{const i=new Date(s);i.setDate(s.getDate()+1),t(i)},n=i=>{const m=new Date;return i.getDate()===m.getDate()&&i.getMonth()===m.getMonth()&&i.getFullYear()===m.getFullYear()};return e.jsx(T,{className:"mb-4 shadow-sm",children:e.jsx(D,{className:"p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(p,{variant:"ghost",size:"icon",onClick:r,"aria-label":"Previous day",children:e.jsx(Se,{})}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"font-medium",children:a(s)}),n(s)&&e.jsx("span",{className:"text-xs text-primary",children:"Today"})]}),e.jsx(p,{variant:"ghost",size:"icon",onClick:o,"aria-label":"Next day",children:e.jsx(Ce,{})})]})})})},Je=({query:s,onQueryChange:t,onSearch:a,onClear:r,isLoading:o,onKeyDown:n,inputRef:i})=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(P,{ref:i,type:"text",placeholder:"Search for a food...",value:s,onChange:m=>t(m.target.value),onKeyDown:n,className:"pr-8"}),s&&e.jsx("button",{type:"button",onClick:r,className:"absolute right-2 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground transition-colors",children:e.jsx(W,{className:"h-4 w-4"})})]}),e.jsxs(p,{type:"button",variant:"secondary",size:"sm",onClick:a,disabled:o||!s.trim()||s.trim().length<2,children:[o?e.jsx(J,{className:"h-4 w-4 animate-spin"}):e.jsx(Fe,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Search"})]})]}),Xe=({food:s,onSelect:t,buttonLabel:a="Add"})=>{const r=Z.extractNutrients(s);return e.jsx("div",{className:"p-3 hover:bg-accent/50 transition-colors",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1 cursor-pointer",onClick:()=>t(s),children:[e.jsx("h4",{className:"font-medium text-sm",children:s.description}),s.brandOwner&&e.jsx("p",{className:"text-xs text-muted-foreground truncate max-w-[90%]",children:s.brandOwner}),e.jsxs("div",{className:"flex flex-wrap gap-x-3 gap-y-1 mt-1 text-xs text-muted-foreground",children:[e.jsxs("span",{className:"font-medium text-foreground",children:[Math.round(r.calories)," cal"]}),e.jsxs("span",{children:["P: ",r.protein.toFixed(1),"g"]}),e.jsxs("span",{children:["C: ",r.carbs.toFixed(1),"g"]}),e.jsxs("span",{children:["F: ",r.fat.toFixed(1),"g"]})]})]}),e.jsxs(p,{size:"sm",variant:"ghost",onClick:()=>t(s),className:"h-7 px-2",children:[e.jsx(ke,{className:"h-3.5 w-3.5 mr-1"}),a]})]})})},he=d.forwardRef(({className:s,children:t,...a},r)=>e.jsxs(me,{ref:r,className:I("relative overflow-hidden",s),...a,children:[e.jsx(Te,{className:"h-full w-full rounded-[inherit]",children:t}),e.jsx(xe,{}),e.jsx(De,{})]}));he.displayName=me.displayName;const xe=d.forwardRef(({className:s,orientation:t="vertical",...a},r)=>e.jsx(ue,{ref:r,orientation:t,className:I("flex touch-none select-none transition-colors",t==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",t==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",s),...a,children:e.jsx(Ie,{className:"relative flex-1 rounded-full bg-border"})}));xe.displayName=ue.displayName;const fe=d.forwardRef(({isLoading:s,error:t,results:a,onSelectFood:r,buttonLabel:o="Add",showInline:n=!1,className:i=""},m)=>e.jsx(T,{ref:m,className:`${n?"":"absolute z-50 left-0 right-0 top-[calc(100%+0.5rem)]"} shadow-md ${i}`,children:e.jsx(D,{className:"p-0 overflow-hidden",children:s?e.jsxs("div",{className:"flex items-center justify-center p-4 text-sm text-muted-foreground",children:[e.jsx(J,{className:"h-4 w-4 mr-2 animate-spin"}),"Searching..."]}):t?e.jsx("div",{className:"p-4 text-sm text-destructive",children:t}):a.length>0?e.jsx(he,{className:"max-h-64 overflow-y-scroll",children:a.map(u=>e.jsx(Xe,{food:u,onSelect:r,buttonLabel:o},u.fdcId))}):null})}));fe.displayName="FoodSearchResults";const Ze=({onSelectFood:s,buttonLabel:t="Add",autoFocus:a=!1,showInline:r=!1})=>{const[o,n]=d.useState(""),[i,m]=d.useState([]),[u,N]=d.useState(!1),[b,l]=d.useState(null),[c,h]=d.useState(!1),j=d.useRef(null),g=d.useRef(null),x=Re(o,300);d.useEffect(()=>{function S(L){j.current&&!j.current.contains(L.target)&&g.current!==L.target&&h(!1)}return document.addEventListener("mousedown",S),()=>document.removeEventListener("mousedown",S)},[]),d.useEffect(()=>{a&&g.current&&g.current.focus()},[a]);const v=d.useCallback(async()=>{if(!(!o.trim()||o.trim().length<2)){N(!0),l(null),h(!0);try{const S=await Z.searchFoods(o);m(S),S.length===0&&l("No foods found matching your search.")}catch(S){l("Failed to search foods. Please try again."),console.error(S)}finally{N(!1)}}},[o]),M=()=>{n(""),m([]),l(null),h(!1),g.current&&g.current.focus()},$=S=>{h(!1),s(S),r?(m([]),l(null)):M()},O=S=>{S.key==="Enter"&&o.trim()?(S.preventDefault(),v()):S.key==="Escape"&&h(!1)};return d.useEffect(()=>{x.trim().length>=2&&v()},[x,v]),e.jsxs("div",{className:"relative w-full",children:[e.jsx(Je,{inputRef:g,query:o,onQueryChange:n,onSearch:v,onClear:M,isLoading:u,onKeyDown:O}),c&&e.jsx(fe,{ref:j,isLoading:u,error:b,results:i,onSelectFood:$,buttonLabel:t,showInline:r})]})},q=({children:s,errorMessage:t,className:a})=>e.jsxs("div",{className:I("space-y-2",a),children:[s,t&&e.jsxs("div",{className:"flex items-center gap-1 text-destructive text-xs",children:[e.jsx(_,{className:"h-3 w-3"}),e.jsx("span",{children:t})]})]}),Ve=({foods:s,className:t=""})=>!s||s.length===0?null:e.jsx("div",{className:`space-y-2 ${t}`,children:s.map((a,r)=>e.jsx("div",{className:"bg-background border rounded-md p-3",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium text-sm",children:a.name}),e.jsxs("div",{className:"flex flex-wrap gap-x-3 gap-y-1 mt-1 text-xs text-muted-foreground",children:[e.jsxs("span",{children:[a.quantity," ",a.unit]}),e.jsxs("span",{children:[a.calories," calories"]}),e.jsxs("span",{children:[a.protein,"g protein"]})]})]}),e.jsx(X,{variant:"outline",className:"text-xs",children:r+1})]})},`food-${r}`))}),es=({meals:s,onDeleteMeal:t,onEditMeal:a,onAddMeal:r,isLoading:o=!1,children:n})=>e.jsxs(T,{className:"w-full",children:[e.jsxs(E,{className:"pb-3 flex flex-row items-center justify-between",children:[e.jsxs(R,{className:"text-lg flex items-center gap-2",children:[e.jsx(oe,{className:"h-5 w-5"}),o&&e.jsx(J,{className:"h-4 w-4 ml-2 animate-spin text-muted-foreground"})]}),r&&e.jsxs(p,{variant:"outline",size:"sm",onClick:r,className:"h-8 gap-1",children:[e.jsx(de,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:"Add Meal"})]})]}),e.jsxs(D,{className:"space-y-3",children:[o?e.jsx("div",{className:"space-y-4 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:Array(3).fill(0).map((m,u)=>e.jsx(T,{className:"h-[180px] overflow-hidden",children:e.jsxs("div",{className:"p-4 h-full flex flex-col",children:[e.jsx(k,{className:"h-5 w-3/4 mb-2"}),e.jsx(k,{className:"h-4 w-1/2 mb-4"}),e.jsxs("div",{className:"flex space-x-2 mb-3",children:[e.jsx(k,{className:"h-4 w-16"}),e.jsx(k,{className:"h-4 w-16"})]}),e.jsx("div",{className:"flex-1"}),e.jsxs("div",{className:"flex justify-between items-center pt-2 mt-auto",children:[e.jsx(k,{className:"h-4 w-16"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(k,{className:"h-8 w-8 rounded-md"}),e.jsx(k,{className:"h-8 w-8 rounded-md"})]})]})]})},`skeleton-${u}`))}):s.length>0?e.jsx("div",{className:"space-y-4 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:s.map((m,u)=>e.jsx(Ye,{meal:m,onDelete:()=>t(u),onEdit:()=>a(u,m),className:"h-full"},`meal-${m.id||u}`))}):e.jsx("div",{className:"py-8 text-center border-dashed border rounded-md bg-muted/40",children:e.jsx("p",{className:"text-muted-foreground",children:"No meals logged."})}),n&&e.jsx("div",{className:"pt-3",children:n})]})]});function ss({className:s,...t}){return e.jsx("textarea",{"data-slot":"textarea",className:I("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),...t})}const as=({notes:s,isLoading:t=!1,onChange:a})=>{const[r,o]=K.useState(s),[n,i]=K.useState(!1),[m,u]=K.useState(!1);K.useEffect(()=>{o(s)},[s]);const N=()=>{o(s),i(!0)},b=()=>{o(s),i(!1)},l=async()=>{u(!0);try{await a(r),i(!1)}catch(c){console.error("Failed to save notes:",c)}finally{u(!1)}};return t?e.jsxs(T,{children:[e.jsx(E,{children:e.jsxs(R,{className:"flex items-center justify-between",children:[e.jsx(k,{className:"h-4 w-16"}),e.jsx(k,{className:"w-20"})]})}),e.jsx(D,{children:e.jsx(k,{className:"w-full"})})]}):e.jsxs(T,{children:[e.jsx(E,{children:e.jsxs(R,{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Notes"}),!n&&e.jsxs(p,{variant:"outline",size:"sm",onClick:N,children:[e.jsx(G,{className:"mr-2"}),s?"Edit":"Add Notes"]})]})}),e.jsx(D,{children:n?e.jsx(ss,{value:r,onChange:c=>o(c.target.value),placeholder:"Add your notes here...",className:"resize-none"}):e.jsx("div",{children:s?e.jsx("p",{className:"whitespace-pre-wrap",children:s}):e.jsx("p",{className:"text-muted-foreground italic",children:"No notes added yet."})})}),n&&e.jsxs(Y,{className:"flex justify-end gap-2",children:[e.jsxs(p,{variant:"ghost",size:"sm",onClick:b,disabled:m,children:[e.jsx(W,{className:"mr-1"}),"Cancel"]}),e.jsxs(p,{variant:"default",size:"sm",onClick:l,disabled:m,children:[e.jsx(Ae,{className:"mr-1"}),m?"Saving...":"Save"]})]})]})},ts=({nutritionEntry:s,onEntryUpdated:t})=>{const[a,r]=d.useState(!1),[o,n]=d.useState(null),i=d.useCallback(async l=>{const c={calories:y([l],"calories"),protein:y([l],"protein"),carbs:y([l],"carbs"),fat:y([l],"fat")};try{const h=await Le({meals:[l],dailyTotals:c});if(!h)return n("Failed to create nutrition entry"),!1;const j=await qe(h);return j?(t(j),!0):(n("Failed to fetch new nutrition entry"),!1)}catch(h){return console.error("Error creating nutrition entry:",h),n("Failed to create new nutrition entry"),!1}},[t]),m=d.useCallback(async l=>{if(!s||!s.id)return n("Missing nutrition entry"),!1;const c=[...s.meals||[],l],h={calories:y(c,"calories"),protein:y(c,"protein"),carbs:y(c,"carbs"),fat:y(c,"fat")};if(!await H(s.id,{meals:c,dailyTotals:h}))return n("Failed to add meal to existing entry"),!1;const g={...s,meals:c,dailyTotals:h};return t(g),!0},[s,t]),u=d.useCallback(async l=>{r(!0),n(null);try{return s!=null&&s.id?await m(l):await i(l)}catch(c){return console.error("Error in addMeal operation:",c),n("An error occurred while processing the meal"),!1}finally{r(!1)}},[s,i,m]),N=d.useCallback(async(l,c)=>{if(!(s!=null&&s.id)||!s.meals)return n("Cannot edit meal: No nutrition entry or meals exist"),!1;if(l<0||l>=s.meals.length)return n("Invalid meal index"),!1;r(!0),n(null);try{const h=[...s.meals];h[l]=c;const j={calories:y(h,"calories"),protein:y(h,"protein"),carbs:y(h,"carbs"),fat:y(h,"fat")};if(await H(s.id,{meals:h,dailyTotals:j})){const x={...s,meals:h,dailyTotals:j};return t(x),!0}return n("Failed to update meal"),!1}catch(h){return console.error("Error editing meal:",h),n("An error occurred while editing the meal"),!1}finally{r(!1)}},[s,t]),b=d.useCallback(async l=>{if(!(s!=null&&s.id)||!s.meals)return n("Cannot delete meal: No nutrition entry or meals exist"),!1;if(l<0||l>=s.meals.length)return n("Invalid meal index"),!1;r(!0),n(null);try{const c=s.meals.filter((g,x)=>x!==l),h={calories:y(c,"calories"),protein:y(c,"protein"),carbs:y(c,"carbs"),fat:y(c,"fat")};if(await H(s.id,{meals:c,dailyTotals:h})){const g={...s,meals:c,dailyTotals:h};return t(g),!0}return n("Failed to delete meal"),!1}catch(c){return console.error("Error deleting meal:",c),n("An error occurred while deleting the meal"),!1}finally{r(!1)}},[s,t]);return{addMeal:u,editMeal:N,deleteMeal:b,isLoading:a,error:o}},us=()=>{const[s,t]=d.useState(new Date),[a,r]=d.useState("hidden"),[o,n]=d.useState(void 0),[i,m]=d.useState(-1),{selectedDateNutritionEntries:u,isLoading:N,refreshData:b,updateNotes:l}=Ee(s),c=u[0],{addMeal:h,editMeal:j,deleteMeal:g,isLoading:x}=ts({nutritionEntry:c,onEntryUpdated:C=>{C?b(C):b()}}),v=N||x,M=d.useCallback(C=>{t(C),r("hidden"),n(void 0)},[]),$=()=>{r("add"),n(void 0),m(-1)},O=async(C,F)=>(n(F),m(C),r("edit"),Promise.resolve()),S=async C=>{try{let F=!1;a==="add"?F=await h(C):a==="edit"&&i!==-1&&(F=await j(i,C)),F&&(r("hidden"),n(void 0),m(-1))}catch(F){console.error("Error handling meal submission:",F)}},L=()=>{r("hidden"),n(void 0),m(-1)},B=a!=="hidden",U=(c==null?void 0:c.meals)||[];return e.jsxs("div",{className:"nutrition-page space-y-4",children:[e.jsx("div",{className:"container mx-auto px-4 max-w-md",children:e.jsx(We,{selectedDate:s,onDateChange:M})}),e.jsx("div",{className:B?"container mx-auto px-4 max-w-md":"container mx-auto px-4",children:B?e.jsx(Ge,{onSubmit:S,onCancel:L,initialMeal:o,isEditing:a==="edit"}):e.jsx(e.Fragment,{children:e.jsx(es,{meals:U,onEditMeal:O,onDeleteMeal:async C=>{await g(C)},onAddMeal:$,isLoading:v})})}),e.jsx("div",{className:"container mx-auto px-4 max-w-md pb-8",children:e.jsx(as,{notes:(c==null?void 0:c.notes)||"",onChange:C=>l((c==null?void 0:c.id)||"",C),isLoading:v})})]})};export{us as Nutrition};
