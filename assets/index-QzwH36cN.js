import{r as c,j as e}from"./vendor-react-b1n3RH4y.js";import{d as b,B as E,C as Z,a as ee,b as fe,I as pe,c as se,u as je,f as te}from"./index-Dh6OigyZ.js";import{ak as ge,al as be,a7 as Ne,am as ae,ab as ye,an as ke,ao as we,ap as re,aq as ve,a5 as Se,ar as ne,as as oe,at as ie,a4 as ce,$ as le,H as de,au as D}from"./vendor-26V6_GIG.js";import{u as Ce}from"./useDebounce-C8AyE5Jv.js";import{T as A}from"./vendor-firebase-BgMWbdUj.js";import{F as Ee}from"./firestore-BVp1zGt2.js";const P=({initialValue:t,onSave:s,as:a="span",className:l,inputClassName:h,type:y="text",displayTextPlaceholder:j="Click to edit",inputProps:d})=>{const[u,w]=c.useState(!1),[g,p]=c.useState(t),S=c.useRef(null),C=a;c.useEffect(()=>{u||p(t)},[t,u]),c.useEffect(()=>{u&&S.current&&S.current.focus()},[u]);const I=()=>{w(!1),s(g.toString())},z=()=>{p(t),w(!1)},T=n=>{p(n.target.value)},x=n=>{n.key==="Enter"?(n.preventDefault(),I()):n.key==="Escape"&&z()},o=()=>{w(!0)},i=n=>{(n.key==="Enter"||n.key===" ")&&(n.preventDefault(),w(!0))};if(u)return e.jsx("input",{ref:S,type:y,value:g,onChange:T,onBlur:I,onKeyDown:x,spellCheck:"false",className:b(l,"bg-transparent border-input focus:border-primary outline-none","text-inherit font-inherit m-0","min-w-[50px]","underline underline-offset-2 decoration-dashed decoration-muted-foreground",y==="number"&&"appearance-none [-moz-appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-outer-spin-button]:m-0 [&::-webkit-inner-spin-button]:appearance-none [&::-webkit-inner-spin-button]:m-0",h),...d});const m=String(g).trim()===""?j:g;return e.jsx(C,{onClick:o,onKeyDown:i,className:b("cursor-text hover:bg-muted/30 dark:hover:bg-muted/20 transition-colors underline underline-offset-2  decoration-muted-foreground",{"text-muted-foreground italic":String(g).trim()===""&&m===j},l),tabIndex:0,role:"button","aria-label":`Edit text. Current value: ${String(g).trim()===""?"empty, placeholder is "+j:g}`,children:m})};function Ie({className:t,...s}){return e.jsx(ge,{"data-slot":"checkbox",className:b("peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",t),...s,children:e.jsx(be,{"data-slot":"checkbox-indicator",className:"flex items-center justify-center text-current transition-none",children:e.jsx(Ne,{className:"size-3.5"})})})}const We=({searchResults:t,onViewExercise:s,onSelectExercise:a})=>e.jsx("div",{className:"space-y-2",children:t.map(l=>e.jsxs("div",{className:"flex justify-between items-center p-4 border rounded-md bg-card text-card-foreground",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:l.name}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(E,{variant:"ghost",size:"icon",onClick:()=>s==null?void 0:s(l.exerciseId),children:e.jsx(ae,{className:"h-4 w-4 text-muted-foreground"})}),e.jsx(E,{variant:"ghost",size:"sm",onClick:()=>a(l.exerciseId),children:"Add"})]})]},l.exerciseId))}),$e=({searchTerm:t,searchResults:s,isSearching:a,error:l,onSearchChange:h,onSelectExercise:y,onViewExercise:j,className:d})=>e.jsxs(Z,{className:b("h-full flex flex-col",d),children:[e.jsx(ee,{className:"py-3 px-3",children:e.jsx(fe,{className:"text-base",children:"Exercise Library"})}),e.jsx("div",{className:"px-3 pb-2",children:e.jsxs("div",{className:"relative",children:[e.jsx(pe,{placeholder:"Search exercises...",value:t,onChange:h,className:"pr-8"}),e.jsx(ye,{className:"absolute right-2 top-2.5 h-4 w-4 text-muted-foreground"})]})}),e.jsx(se,{className:"flex-1 p-2 overflow-y-auto max-h-[calc(100vh-200px)]",children:a?e.jsx("div",{className:"flex items-center justify-center h-24",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Searching..."})}):l?e.jsx("div",{className:"flex items-center justify-center h-24",children:e.jsx("p",{className:"text-sm text-destructive",children:l})}):t.trim()!==""&&s.length===0?e.jsx("div",{className:"flex items-center justify-center h-24",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"No exercises found"})}):t.trim()===""?e.jsx("div",{className:"flex items-center justify-center h-24",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Enter a keyword to search exercises"})}):e.jsx(We,{searchResults:s,onSelectExercise:y,onViewExercise:j})})]}),ue=ke,De=we,me=c.forwardRef(({className:t,...s},a)=>e.jsx(ie,{ref:a,className:b("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...s}));me.displayName=ie.displayName;const L=c.forwardRef(({className:t,children:s,...a},l)=>e.jsxs(De,{children:[e.jsx(me,{}),e.jsxs(re,{ref:l,className:b("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...a,children:[s,e.jsxs(ve,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[e.jsx(Se,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));L.displayName=re.displayName;const V=({className:t,...s})=>e.jsx("div",{className:b("flex flex-col space-y-1.5 text-center sm:text-left",t),...s});V.displayName="DialogHeader";const xe=({className:t,...s})=>e.jsx("div",{className:b("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...s});xe.displayName="DialogFooter";const K=c.forwardRef(({className:t,...s},a)=>e.jsx(ne,{ref:a,className:b("text-lg font-semibold leading-none tracking-tight",t),...s}));K.displayName=ne.displayName;const U=c.forwardRef(({className:t,...s},a)=>e.jsx(oe,{ref:a,className:b("text-sm text-muted-foreground",t),...s}));U.displayName=oe.displayName;const Ae=({title:t,isOpen:s,onClose:a,children:l})=>e.jsx(ue,{open:s,onOpenChange:a,children:e.jsxs(L,{children:[e.jsxs(V,{children:[e.jsxs(K,{children:["Add Exercise to ",t]}),e.jsx(U,{children:"Search and select an exercise to add to your workout."})]}),e.jsx("div",{className:"mt-4 h-96",children:l})]})});function Te({className:t,...s}){return e.jsx("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:e.jsx("table",{"data-slot":"table",className:b("w-full caption-bottom text-sm",t),...s})})}function Re({className:t,...s}){return e.jsx("thead",{"data-slot":"table-header",className:b("[&_tr]:border-b",t),...s})}function ze({className:t,...s}){return e.jsx("tbody",{"data-slot":"table-body",className:b("[&_tr:last-child]:border-0",t),...s})}function H({className:t,...s}){return e.jsx("tr",{"data-slot":"table-row",className:b("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",t),...s})}function _({className:t,...s}){return e.jsx("th",{"data-slot":"table-head",className:b("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...s})}function F({className:t,...s}){return e.jsx("td",{"data-slot":"table-cell",className:b("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...s})}const Fe=({exercise:t,onAddSet:s,onDeleteSet:a,OnSaveReps:l,OnSaveWeight:h,className:y,id:j})=>{const{sets:d=0,weight:u=0,reps:w=0,exerciseId:g}=t;return e.jsx("div",{className:`rounded border p-4 bg-card text-card-foreground ${y??""}`,id:j,children:e.jsxs(Te,{children:[e.jsx(Re,{children:e.jsxs(H,{children:[e.jsx(_,{className:"w-1/4",children:"Set"}),e.jsx(_,{className:"w-1/4",children:"Reps"}),e.jsx(_,{className:"w-1/4",children:"Weight"}),e.jsx(_,{className:"w-1/4 text-right"})]})}),e.jsxs(ze,{children:[Array.from({length:d},(p,S)=>e.jsxs(H,{children:[e.jsx(F,{children:S+1}),e.jsx(F,{children:e.jsx(P,{className:"w-16",initialValue:w,onSave:C=>l&&l(C)})}),e.jsx(F,{children:e.jsx(P,{className:"w-16",initialValue:u,onSave:C=>h&&h(C)})}),e.jsx(F,{className:"text-right",children:d>1&&e.jsx(E,{variant:"ghost",size:"icon",onClick:a?()=>a(g):void 0,children:e.jsx(ce,{className:"h-4 w-4"})})})]},S)),e.jsx(H,{children:e.jsx(F,{colSpan:4,className:"text-center ",children:e.jsx(E,{variant:"ghost",size:"icon",onClick:s?()=>s(g):void 0,className:"w-full",children:e.jsx(le,{className:"h-full w-3"})})})})]})]})})},Pe=({exercise:t,isOpen:s,onClose:a})=>t?e.jsx(ue,{open:s,onOpenChange:a,children:e.jsxs(L,{className:"max-w-md",children:[e.jsxs(V,{children:[e.jsx(K,{children:t.name}),e.jsxs(U,{children:[t.targetMuscles," - ",t.equipments]})]}),e.jsx("div",{className:"space-y-4 mt-4",children:t.instructions&&t.instructions.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-2",children:"Instructions:"}),t.instructions.map((l,h)=>e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:l},h))]})}),e.jsx(xe,{className:"flex justify-between",children:e.jsx(E,{onClick:a,size:"sm",children:"Close"})})]})}):null,Oe=({children:t,plannedExercise:s,workout:a,isSearching:l,removeExerciseFromWorkout:h,handleViewExerciseDetails:y})=>e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h4",{className:"font-medium",children:s.name}),e.jsx("div",{children:e.jsxs("div",{className:"flex flex-row",children:[e.jsx(E,{variant:"ghost",size:"icon",onClick:()=>y(s.exerciseId),"aria-label":`View details for ${s.name}`,children:l?e.jsx(de,{className:"h-4 w-4 animate-spin"}):e.jsx(ae,{className:"h-4 w-4"})}),e.jsx(E,{variant:"ghost",size:"icon",onClick:()=>h(a.id,s.exerciseId),"aria-label":`Remove ${s.name} from workout`,children:e.jsx(ce,{className:"h-4 w-4 text-red-400"})})]})})]}),t]},s.exerciseId),Me=()=>{const[t,s]=c.useState(""),a=Ce(t,500),[l,h]=c.useState(!1),[y,j]=c.useState([]),[d,u]=c.useState(null);c.useEffect(()=>{(async()=>{if(!a.trim()){j([]);return}h(!0),u(null);try{const p=await Q.searchExercises(a);p.success&&Array.isArray(p.data)?j(p.data):(u("Couldn't retrieve exercise data. Format error."),j([]))}catch(p){console.error("Error searching exercises:",p),u("Couldn't connect to exercise database."),j([])}finally{h(!1)}})()},[a]);const w=c.useCallback(async g=>{h(!0);try{const p=await Q.getExerciseById(g);return p.success?p.data:(u("Failed to fetch exercise details. Please try again."),null)}catch(p){return console.error("Error fetching exercise details:",p),u("Failed to fetch exercise details. Please try again."),null}finally{h(!1)}},[]);return{searchTerm:t,searchResults:y,isSearching:l,error:d,setSearchTerm:s,selectExercise:w}},G=(t,s)=>{const a=A.now();return{id:`temp-plan-${a.toMillis()}`,name:t,workouts:s,createdAt:a,updatedAt:a}},Be=()=>{const{user:t}=je(),{state:s}=te(),a=s.userPreferences.workoutDaysPerWeek,[l,h]=c.useState(!0),[y,j]=c.useState(!1),[d,u]=c.useState(void 0);c.useEffect(()=>{if(h(!0),t){const x=Array.from({length:a},(o,i)=>({id:`workout-template-${Date.now()}-${i}`,name:`Workout ${i+1}`,exercises:[],completed:!1}));u(G("My Workout Plan",x))}else u(void 0);h(!1)},[t,a]);const w=c.useCallback((x,o)=>{u(i=>{if(!i)return i;const m=i.workouts.map(n=>{if(n.id!==x)return n;if(n.exercises.some(k=>k.exerciseId===o.exerciseId))return D.error("Exercise Already Exists",{description:`"${o.name}" is already in "${n.name}".`}),n;const N={...o,sets:1,reps:10,weight:0};return D("Exercise Added",{description:`"${o.name}" added to "${n.name}".`}),{...n,exercises:[...n.exercises,N]}});return{...i,workouts:m,updatedAt:A.now()}})},[]),g=c.useCallback((x,o)=>{u(i=>{if(!i)return i;let m,n;const N=i.workouts.map(k=>{if(k.id!==x)return k;const W=k.exercises.find($=>$.exerciseId===o);return W&&(m=W.name,n=k.name),{...k,exercises:k.exercises.filter($=>$.exerciseId!==o)}});return m&&n&&D("Exercise Removed",{description:`"${m}" removed from "${n}".`}),{...i,workouts:N,updatedAt:A.now()}})},[]),p=c.useCallback((x,o,i)=>{u(m=>{if(!m)return m;const n=m.workouts.map(N=>{if(N.id!==x)return N;const k=N.exercises.map(W=>{if(W.exerciseId!==o)return W;const $=N.exercises.find(O=>O.exerciseId===o),R={...W,...i};return i.sets!==void 0&&$&&D.info(`Sets for ${$.name} updated to ${i.sets} in ${N.name}`),R});return{...N,exercises:k}});return{...m,workouts:n,updatedAt:A.now()}})},[]),S=c.useCallback((x,o)=>{u(i=>{if(!i)return i;const m=i.workouts.map(n=>n.id===x?{...n,name:o}:n);return{...i,workouts:m,updatedAt:A.now()}})},[]),C=c.useCallback(x=>{u(o=>{const i=A.now();if(!o){const m=Array.from({length:a},(n,N)=>({id:`workout-template-${Date.now()}-${N}`,name:`Workout ${N+1}`,exercises:[]}));return G(x,m)}return{...o,name:x,updatedAt:i}})},[a]),I=c.useCallback(()=>{if(!t){D.error("User not authenticated. Cannot save workout plan.");return}if(!d){D.error("Workout plan is not initialized. Cannot save.");return}const x=d.name||"My Workout Plan",o=A.now(),i=d.id&&!d.id.startsWith("temp-plan-")?d.id:`${x.replace(/\s+/g,"-")}-${o.toMillis()}`,m={...d,id:i,name:x,updatedAt:o,createdAt:d.createdAt||o};return u(m),m},[t,d]),z=c.useMemo(()=>(d==null?void 0:d.workouts)||[],[d]),T=c.useCallback(async()=>{const x=I();if(!x)return!1;j(!0);try{return await _e(x),!0}catch(o){return console.error("Error saving workout plan:",o),!1}finally{j(!1)}},[I]);return{isLoading:l,isSaving:y,plannedWorkouts:d,workouts:z,numberOfWorkoutsPerWeek:a,addExerciseToWorkout:w,removeExerciseFromWorkout:g,updateExerciseInWorkout:p,preparePlanForSave:I,setWorkoutName:S,setWorkoutTitle:C,saveWorkoutPlan:T}},Xe=()=>{var Y;const{workouts:t,plannedWorkouts:s,isLoading:a,isSaving:l,addExerciseToWorkout:h,removeExerciseFromWorkout:y,updateExerciseInWorkout:j,setWorkoutTitle:d,setWorkoutName:u,saveWorkoutPlan:w}=Be(),{state:g,setWorkoutDaysPerWeek:p}=te(),{searchTerm:S,searchResults:C,isSearching:I,error:z,setSearchTerm:T,selectExercise:x}=Me(),[o,i]=c.useState(null),[m,n]=c.useState(null),N=r=>{i(r)},k=async r=>{const f=await x(r);f&&n(f)},W=r=>{o&&h(o,r),R()},$=r=>{if(o){const f=C.find(v=>v.exerciseId===r);f&&h(o,f)}R()},R=()=>{i(null),n(null),T("")},O=(r,f,v)=>{const M=f.sets||0,B=v?M+1:Math.max(0,M-1);j(r,f.exerciseId,{sets:B})},X=(r,f,v,M)=>{console.log("reps",v);const B=typeof v=="string"?parseInt(v,10):v;isNaN(B)||j(r,f.exerciseId,{[M]:B})},he=async()=>{await w()?D.success("Workout plan saved successfully!"):D.error("Failed to save workout plan.")};return e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx(P,{as:"h1",className:"text-2xl font-bold",initialValue:(s==null?void 0:s.name)||"",onSave:r=>d(r)}),e.jsx("div",{className:"flex justify-end items-center space-x-4",children:e.jsxs("p",{className:"text-sm text-gray-500",children:["You prefer to work out",e.jsx(P,{as:"span",className:"font-medium mx-1 fit-content w-8",initialValue:g.userPreferences.workoutDaysPerWeek.toString(),onSave:r=>p(parseInt(r)),type:"number"}),"times a week."]})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:t.map(r=>e.jsxs(Z,{id:`workout-${r.id}`,children:[e.jsx(ee,{children:e.jsx("div",{className:"flex justify-between items-start",children:e.jsxs("div",{className:"flex flex-row justify-between items-center w-full",children:[e.jsx(P,{className:"text-sm font-semibold",initialValue:r.name,onSave:f=>u(r.id,f)}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"completed?"}),e.jsx(Ie,{className:"h-4 w-4",id:`workout-completed-${r.id}`})]})]})})}),e.jsxs(se,{children:[e.jsxs(E,{variant:"outline",className:"w-full mb-4",onClick:()=>N(r.id),children:[e.jsx(le,{className:"mr-2 h-4 w-4"})," Add Exercise"]}),e.jsx("div",{className:"space-y-4",children:r.exercises.map(f=>e.jsx(Oe,{plannedExercise:f,workout:r,removeExerciseFromWorkout:y,handleViewExerciseDetails:k,children:e.jsx(Fe,{exercise:f,onAddSet:()=>O(r.id,f,!0),onDeleteSet:()=>O(r.id,f,!1),OnSaveReps:v=>X(r.id,f,v,"reps"),OnSaveWeight:v=>X(r.id,f,v,"weight")})},f.exerciseId))})]})]},r.id))}),e.jsx(Pe,{exercise:m,isOpen:!!m,onClose:R}),e.jsx(Ae,{title:`Add Exercise to ${((Y=t.find(r=>r.id===o))==null?void 0:Y.name)||"Workout"}`,isOpen:!!o,onClose:R,onSelectExercise:W,onViewExercise:()=>console.log(""),children:e.jsx($e,{searchTerm:S,searchResults:C,isSearching:I,error:z,onSearchChange:r=>T(r.target.value),onSelectExercise:$,onViewExercise:k})}),e.jsx("div",{className:"fixed bottom-4 right-4 z-50",children:e.jsxs(E,{variant:"default",onClick:he,disabled:a||!s,children:[l&&e.jsx(de,{className:"animate-spin mr-2"}),"Save Workout Plan"]})})]})},J="https://exercisedb-api.vercel.app/api/v1",Q={getExerciseById:async t=>{try{const s=await fetch(`${J}/exercises/${t}`);if(!s.ok)throw new Error(`Exercise API error: ${s.status}`);return await s.json()}catch(s){throw console.error(`Error getting exercise data for ID ${t}:`,s),s}},searchExercises:async t=>{try{const s=await fetch(`${J}/exercises/autocomplete?search=${encodeURIComponent(t)}`);if(!s.ok)throw new Error(`Exercise API error: ${s.status}`);return await s.json()}catch(s){throw console.error("Error searching exercises:",s),s}}},q=new Ee("plannedWorkouts"),_e=async t=>{try{return await q.add(t),!0}catch(s){return console.error("Error adding workout:",s),!1}},Ye=async()=>{try{return await q.getAll()}catch(t){return console.error("Error fetching workouts:",t),[]}},Ge=async t=>{try{return await q.delete(t),!0}catch(s){return console.error("Error deleting workout:",s),!1}};export{Pe as DetailsDialog,Fe as ExerciseItem,$e as SearchPanel,Ae as SelectionDialog,Oe as WorkoutColumn,Xe as WorkoutPlanner,_e as addPlannedWorkout,Ge as deletePlannedWorkout,Q as exerciseApi,Ye as getPlannedWorkouts,Me as useExerciseData,Be as useWorkoutPlanner};
