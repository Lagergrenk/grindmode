import{T as b}from"./vendor-firebase-TzzhK1Gx.js";import{F as I}from"./index-RZU90Lwd.js";import{r as s}from"./vendor-react-BG_21XCX.js";import{ak as L}from"./vendor-DdkT1QD4.js";const U=n=>new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric"}).format(n);function Y(n){const[a,f]=n.split(":").map(Number),g=new Date;return g.setHours(a,f,0,0),b.fromDate(g)}function j(n){return n.toDate().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}const l=new I("nutrition"),v=async n=>{try{return await l.add(n)}catch(a){throw console.error("Error adding nutrition entry:",a),a}},x=async n=>{try{return await l.getAll(n)}catch(a){return console.error("Error fetching nutrition entries:",a),[]}},G=async n=>{try{return await l.getById(n)}catch(a){return console.error(`Error fetching nutrition entry ${n}:`,a),null}},C=async(n,a)=>{try{return await l.update(n,a)}catch(f){return console.error(`Error updating nutrition entry ${n}:`,f),!1}},M=async n=>{try{return await l.delete(n)}catch(a){return console.error(`Error deleting nutrition entry ${n}:`,a),!1}},V=async n=>{try{return await l.getByDate(n)}catch(a){return console.error("Error fetching nutrition entries by date:",a),[]}},q=async()=>{try{const n=new Date,a=new Date(n);return a.setDate(n.getDate()-7),await l.getByDateRange(a,n)}catch(n){return console.error("Error fetching nutrition summary:",n),[]}},J=n=>{const[a,f]=s.useState([]),[g,k]=s.useState([]),[m,N]=s.useState([]),[W,o]=s.useState(!1),[S,p]=s.useState(0),T=s.useCallback(t=>{if(!t.date)return!1;const e=new Date,r=new Date;r.setDate(e.getDate()-7);const i=t.date.toDate();return i>=r&&i<=e},[]),y=s.useCallback(t=>{t&&(k(e=>e.some(r=>r.id===t.id)?e.map(r=>r.id===t.id?t:r):[t,...e]),T(t)&&N(e=>e.some(r=>r.id===t.id)?e.map(r=>r.id===t.id?t:r):[t,...e]),f(e=>e.some(r=>r.id===t.id)?e.map(r=>r.id===t.id?t:r):[t,...e])),p(e=>e+1)},[T]);s.useEffect(()=>{(async()=>{o(!0);try{const e=await V(n);k(e)}catch(e){console.error("Error fetching nutrition entries by date:",e)}finally{o(!1)}})()},[n]),s.useEffect(()=>{(async()=>{o(!0);try{const e=new Date;new Date().setDate(e.getDate()-7);const i=await q();N(i)}catch(e){console.error("Error fetching weekly nutrition entries:",e)}finally{o(!1)}})()},[S]),s.useEffect(()=>{(async()=>{o(!0);try{const e=await x();f(e)}catch(e){console.error("Error fetching all nutrition entries:",e)}finally{o(!1)}})()},[S]);const h=s.useCallback(()=>{const t=new Set;m.forEach(d=>{if(!d.date)return;const c=d.date.toDate(),u=`${c.getFullYear()}-${c.getMonth()}-${c.getDate()}`;t.add(u)});const e=m.reduce((d,c)=>{var u;return d+(((u=c.dailyTotals)==null?void 0:u.calories)||0)},0),r=m.reduce((d,c)=>{var u;return d+(((u=c.dailyTotals)==null?void 0:u.protein)||0)},0),i=t.size,D=i>0?e/i:0,E=i>0?r/i:0;return{averageCalories:D,averageProtein:E,daysTracked:i}},[m]),w=s.useCallback(()=>{var e,r,i;const t=a.find(D=>{if(!D.date)return!1;const E=D.date.toDate();return L(E)});return{calories:((e=t==null?void 0:t.dailyTotals)==null?void 0:e.calories)||0,protein:((r=t==null?void 0:t.dailyTotals)==null?void 0:r.protein)||0,meals:((i=t==null?void 0:t.meals)==null?void 0:i.length)||0}},[a]),$=s.useMemo(()=>{const t=h();return{today:w(),weekly:{averageCalories:t.averageCalories,averageProtein:t.averageProtein,daysTracked:t.daysTracked}}},[h,w]),A=async t=>{o(!0);try{const e={...t,date:t.date||b.fromDate(n)},r=await v(e);return r?(y(),r):null}catch(e){return console.error("Error adding nutrition entry:",e),null}finally{o(!1)}},B=async(t,e)=>{o(!0);try{return await C(t,e)?(y(),!0):!1}catch(r){return console.error("Error updating nutrition entry:",r),!1}finally{o(!1)}},F=async t=>{o(!0);try{return await M(t)?(y(),!0):!1}catch(e){return console.error("Error deleting nutrition entry:",e),!1}finally{o(!1)}},P=s.useCallback(async(t,e)=>{o(!0);try{return await C(t,{notes:e})?(y(),!0):!1}catch(r){return console.error("Error updating notes:",r),!1}finally{o(!1)}},[y]);return{isLoading:W,allNutritionEntries:a,weeklyNutritionEntries:m,selectedDateNutritionEntries:g,nutritionSummary:$,addEntry:A,updateEntry:B,deleteEntry:F,updateNotes:P,getWeeklySummary:h,getTodayData:w,refreshData:y}};export{j as a,Y as b,v as c,C as d,U as f,G as g,J as u};
