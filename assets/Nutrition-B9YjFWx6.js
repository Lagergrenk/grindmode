import{c as z,j as e,S as Be,f as O,g as Ye,h as q,I as Q,r as i,T as je,C as I,a as B,b as Y,d as M,i as le,B as S,k as Xe,l as Ke,m as Qe,L as ce,n as K,o as Ge,p as Je,P as J,q as se,s as W,t as $,v as Ze,R as Z}from"./index-D4A55r9M.js";import{S as we,a as Ne,b as Se,c as ye,d as Ce,C as Ve,e as es}from"./select-CAsNgvUz.js";import{a as ss,b as ts,c as rs,g as as,d as ne,u as ns}from"./useNutritionEntry-nogTi35M.js";import{T as Te,X as ie,S as os,u as ls}from"./useDebounce-DZCDvCmu.js";import{C as Pe}from"./firestore-DqkfDWpO.js";import{C as cs}from"./check-eVLZ_fta.js";/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const is=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],ds=z("arrow-left",is);/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ms=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],G=z("circle-alert",ms);/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const us=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]],hs=z("clock",us);/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fs=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],xs=z("pen",fs);/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ps=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],vs=z("plus",ps);/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bs=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],gs=z("save",bs);/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const js=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],oe=z("square-pen",js);/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ws=[["path",{d:"M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2",key:"cjf0a3"}],["path",{d:"M7 2v20",key:"1473qp"}],["path",{d:"M21 15V2a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7",key:"j28e5"}]],ke=z("utensils",ws),Ns=Ye("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function de({className:s,variant:r,asChild:t=!1,...n}){const a=t?Be:"span";return e.jsx(a,{"data-slot":"badge",className:O(Ns({variant:r}),s),...n})}const Ss=({message:s,className:r})=>s?e.jsxs("div",{className:O("flex items-center gap-2 text-destructive text-sm",r),children:[e.jsx(G,{className:"h-4 w-4"}),e.jsx("span",{children:s})]}):null;function R({className:s,...r}){return e.jsx("div",{"data-slot":"skeleton",className:O("bg-accent animate-pulse rounded-md",s),...r})}const ys=[{value:"breakfast",label:"Breakfast"},{value:"lunch",label:"Lunch"},{value:"dinner",label:"Dinner"},{value:"snack",label:"Snack"},{value:"other",label:"Other"}],Cs=({name:s,time:r,onNameChange:t,onTimeChange:n})=>e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs(U,{children:[e.jsx(q,{htmlFor:"meal-name",children:"Meal Type"}),e.jsxs(we,{value:s,onValueChange:t,children:[e.jsx(Ne,{id:"meal-name",className:"max-w-[180px]",children:e.jsx(Se,{placeholder:"Select meal type"})}),e.jsx(ye,{children:ys.map(a=>e.jsx(Ce,{value:a.value,children:a.label},a.value))})]})]}),e.jsxs(U,{children:[e.jsx(q,{htmlFor:"meal-time",children:"Time"}),e.jsx(Q,{id:"meal-time",type:"time",value:r,onChange:n,className:"max-w-[180px]"})]})]}),Ts=({onSubmit:s,onCancel:r,initialMeal:t,isEditing:n=!1})=>{const[a,o]=i.useState((t==null?void 0:t.name)||""),[c,m]=i.useState((t==null?void 0:t.time)||je.now()),[u,x]=i.useState({mealName:""}),[h,l]=i.useState(!1),d=()=>{const g={mealName:""};let j=!0;return a||(g.mealName="Meal type is required",j=!1),x(g),j},f=async g=>{if(g.preventDefault(),!!d())try{l(!0),await s({name:a,time:c})}catch(j){console.error("Error submitting meal form:",j)}finally{l(!1)}},p=g=>{o(g),g&&x(j=>({...j,mealName:""}))},w=g=>{m(ts(g.target.value))};return e.jsxs(I,{className:"w-full",children:[e.jsx(B,{children:e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(ke,{className:"h-5 w-5"}),n?"Edit Meal":"Add New Meal"]})}),e.jsxs("form",{onSubmit:f,children:[e.jsxs(M,{className:"space-y-4",children:[e.jsx(Cs,{name:a,time:ss(c),onNameChange:p,onTimeChange:w}),u.mealName&&e.jsx(Ss,{message:u.mealName})]}),e.jsxs(le,{className:"flex justify-end gap-2 border-t pt-4 mt-1",children:[e.jsx(S,{type:"button",variant:"outline",onClick:r,disabled:h,children:"Cancel"}),e.jsx(S,{type:"submit",disabled:h,children:h?"Saving...":n?"Save Changes":"Save Meal"})]})]})]})},Ps=s=>{const r={name:"",quantity:"",calories:"",protein:"",carbs:"",fat:""};let t=!0;return s.name.trim()||(r.name="Food name is required",t=!1),s.quantity<=0&&(r.quantity="Quantity must be greater than 0",t=!1),s.calories<0&&(r.calories="Calories cannot be negative",t=!1),s.protein<0&&(r.protein="Protein cannot be negative",t=!1),s.carbs<0&&(r.carbs="Carbs cannot be negative",t=!1),s.fat<0&&(r.fat="Fat cannot be negative",t=!1),{isValid:t,newErrors:r}},ve="aGILeRnIJ3bHhfVWbBagI6fbyRwqbzDGOf5x1FB3",be="https://api.nal.usda.gov/fdc/v1",H={calories:1008,protein:1003,carbs:1005,fat:1004,fiber:1079,sugar:2e3,sodium:1093},me={searchFoods:async(s,r=20)=>{try{const t=await fetch(`${be}/foods/search?api_key=${ve}&query=${encodeURIComponent(s)}&pageSize=${r}`);if(!t.ok)throw new Error(`USDA API error: ${t.status}`);return(await t.json()).foods||[]}catch(t){throw console.error("Error searching foods:",t),t}},getFoodDetails:async s=>{try{const r=await fetch(`${be}/food/${s}?api_key=${ve}`);if(!r.ok)throw new Error(`USDA API error: ${r.status}`);return await r.json()}catch(r){throw console.error(`Error getting food details for ID ${s}:`,r),r}},extractNutrients:s=>{const r={calories:0,protein:0,carbs:0,fat:0,fiber:0,sugar:0,sodium:0};return s.foodNutrients.forEach(t=>{switch(t.nutrientId){case H.calories:r.calories=t.value;break;case H.protein:r.protein=t.value;break;case H.carbs:r.carbs=t.value;break;case H.fat:r.fat=t.value;break;case H.fiber:r.fiber=t.value;break;case H.sugar:r.sugar=t.value;break;case H.sodium:r.sodium=t.value;break}}),r}},ks=[{value:"g",label:"grams (g)"},{value:"ml",label:"milliliters (ml)"}],As=[{id:"calories",label:"Calories",placeholder:"165",unit:""},{id:"protein",label:"Protein",placeholder:"31",unit:"g"},{id:"carbs",label:"Carbs",placeholder:"0",unit:"g"},{id:"fat",label:"Fat",placeholder:"3.6",unit:"g"}],Es=({onSubmit:s,onCancel:r,initValues:t})=>{const[n,a]=i.useState({name:(t==null?void 0:t.name)||"",quantity:(t==null?void 0:t.quantity)||100,calories:(t==null?void 0:t.calories)||0,protein:(t==null?void 0:t.protein)||0,carbs:(t==null?void 0:t.carbs)||0,fat:(t==null?void 0:t.fat)||0,unit:(t==null?void 0:t.unit)||"g"}),[o,c]=i.useState({name:"",quantity:"",calories:"",protein:"",carbs:"",fat:""}),m=l=>{const d=me.extractNutrients(l);a({...n,name:l.description,quantity:100,calories:Math.round(d.calories||0),protein:Math.round(d.protein||0),carbs:Math.round(d.carbs||0),fat:Math.round(d.fat||0)}),c({name:"",quantity:"",calories:"",protein:"",carbs:"",fat:""})},u=l=>{const{id:d,value:f}=l.target,p=d.replace("food-",""),g=["quantity","calories","protein","carbs","fat"].includes(p)?parseFloat(f)||0:f;a(j=>({...j,[p]:g})),o[p]&&c(j=>({...j,[p]:""}))},x=l=>{a(d=>({...d,unit:l}))},h=l=>{l.preventDefault();const d=Ps(n);c(d.newErrors),d.isValid&&s(n)};return e.jsxs("form",{onSubmit:h,className:"space-y-4",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx(q,{className:"text-sm font-medium block mb-2",children:"Search USDA Food Database"}),e.jsx(Qs,{onSelectFood:m,buttonLabel:"Select",autoFocus:!t}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Search for foods to automatically fill nutrition information"})]}),e.jsxs(U,{children:[e.jsx(q,{htmlFor:"food-name",className:"text-sm font-medium",children:"Food Name"}),e.jsx(Q,{id:"food-name",placeholder:"e.g., Chicken Breast",value:n.name,onChange:u,className:o.name?"border-destructive":""}),o.name&&e.jsxs("div",{className:"flex items-center mt-1 text-destructive text-xs",children:[e.jsx(G,{className:"h-3 w-3 mr-1"}),e.jsx("span",{children:o.name})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs(U,{children:[e.jsx(q,{htmlFor:"food-quantity",className:"text-sm font-medium",children:"Quantity"}),e.jsx(Q,{id:"food-quantity",type:"number",placeholder:"100",value:n.quantity===0?"":n.quantity,onChange:u,min:"0",step:"any",className:o.quantity?"border-destructive":""}),o.quantity&&e.jsxs("div",{className:"flex items-center mt-1 text-destructive text-xs",children:[e.jsx(G,{className:"h-3 w-3 mr-1"}),e.jsx("span",{children:o.quantity})]})]}),e.jsxs(U,{children:[e.jsx(q,{htmlFor:"food-unit",className:"text-sm font-medium",children:"Unit"}),e.jsxs(we,{value:n.unit,onValueChange:x,children:[e.jsx(Ne,{id:"food-unit",children:e.jsx(Se,{placeholder:"Select unit"})}),e.jsx(ye,{children:ks.map(l=>e.jsx(Ce,{value:l.value,children:l.label},l.value))})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium mb-2",children:"Nutrition Information"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:As.map(l=>e.jsxs(U,{children:[e.jsxs(q,{htmlFor:`food-${l.id}`,className:"text-sm font-medium",children:[l.label,l.unit?` (${l.unit})`:""]}),e.jsx(Q,{id:`food-${l.id}`,type:"number",placeholder:l.placeholder,value:n[l.id]===0?"":n[l.id],onChange:u,min:"0",step:"any",className:o[l.id]?"border-destructive":""}),o[l.id]&&e.jsxs("div",{className:"flex items-center mt-1 text-destructive text-xs",children:[e.jsx(G,{className:"h-3 w-3 mr-1"}),e.jsx("span",{children:o[l.id]})]})]},l.id))})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx(S,{type:"button",variant:"outline",size:"sm",onClick:r,children:"Cancel"}),e.jsxs(S,{type:"submit",size:"sm",children:[t?"Update":"Add"," Food Item"]})]})]})},Rs=({onSubmit:s,onCancel:r,initialMeal:t,isEditing:n=!1})=>{const[a,o]=i.useState("meal"),[c,m]=i.useState({name:(t==null?void 0:t.name)||"",time:(t==null?void 0:t.time)||je.now()}),[u,x]=i.useState((t==null?void 0:t.foods)||[]),[h,l]=i.useState(!1),[d,f]=i.useState(null),[p,w]=i.useState(null),[g,j]=i.useState(!1),A=async b=>{m(b),o("food")},D=()=>{l(!0),f(null),w(null)},E=b=>{l(!0),f(u[b]),w(b)},y=b=>{x(C=>C.filter((pe,ae)=>ae!==b))},P=b=>{x(p!==null?C=>C.map((pe,ae)=>ae===p?b:pe):C=>[...C,b]),l(!1),f(null),w(null)},_=()=>{l(!1),f(null),w(null)},L=()=>{o("meal")},v=async()=>{if(!(!c||u.length===0)){j(!0);try{const b={id:(t==null?void 0:t.id)||`meal-${Date.now()}`,name:c.name,time:c.time,foods:u};await s(b)}catch(b){console.error("Error submitting meal:",b)}finally{j(!1)}}},N=u.reduce((b,C)=>(b.calories+=C.calories*C.quantity/100,b.protein+=C.protein*C.quantity/100,b.carbs+=C.carbs*C.quantity/100,b.fat+=C.fat*C.quantity/100,b),{calories:0,protein:0,carbs:0,fat:0});return e.jsxs(I,{className:"w-full",children:[e.jsx(B,{children:e.jsxs(Y,{children:[n?"Edit Meal":"Add New Meal",a==="food"&&e.jsxs(de,{className:"ml-2",children:[u.length," items"]})]})}),e.jsx(M,{children:a==="meal"?e.jsx(Ts,{onSubmit:A,onCancel:r,initialMeal:c,isEditing:n}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-muted p-3 rounded-md flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium capitalize",children:c.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(c.time.toMillis()).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),e.jsxs(S,{variant:"outline",size:"sm",onClick:L,children:[e.jsx(oe,{className:"h-4 w-4 mr-2"}),"Edit"]})]}),h?e.jsx("div",{className:"border rounded-lg p-4",children:e.jsx(Es,{onSubmit:P,onCancel:_,initValues:d||void 0})}):e.jsxs("div",{className:"space-y-3",children:[u.length>0&&e.jsxs("div",{className:"space-y-2",children:[u.map((b,C)=>e.jsxs("div",{className:"border rounded-lg p-3 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:b.name}),e.jsxs("div",{className:"flex gap-3 text-sm text-muted-foreground",children:[e.jsxs("span",{children:[b.quantity," ",b.unit]}),e.jsxs("span",{children:[b.calories," kcal"]}),e.jsxs("span",{children:[b.protein,"g protein"]})]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(S,{variant:"ghost",size:"sm",onClick:()=>E(C),className:"h-8 w-8 p-0",children:e.jsx(oe,{className:"h-4 w-4"})}),e.jsx(S,{variant:"ghost",size:"sm",onClick:()=>y(C),className:"h-8 w-8 p-0 text-destructive hover:bg-destructive/10",children:e.jsx(Te,{className:"h-4 w-4"})})]})]},C)),e.jsxs("div",{className:"bg-secondary/40 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium text-sm",children:"Total calories:"}),e.jsxs("span",{className:"font-medium text-sm",children:[N.calories," kcal"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium text-sm",children:"Total protein:"}),e.jsxs("span",{className:"font-medium text-sm",children:[N.protein,"g"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium text-sm",children:"Total carbs:"}),e.jsxs("span",{className:"font-medium text-sm",children:[N.carbs,"g"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium text-sm",children:"Total fat:"}),e.jsxs("span",{className:"font-medium text-sm",children:[N.fat,"g"]})]})]})]}),e.jsxs(S,{variant:"outline",className:"w-full",onClick:D,children:[e.jsx(Pe,{className:"h-4 w-4 mr-2"}),u.length?"Add Another Food":"Add Food Item"]})]})]})}),a==="food"&&!h&&e.jsxs(le,{className:"border-t pt-4 flex justify-between",children:[e.jsxs(S,{variant:"ghost",onClick:r,disabled:g,children:[e.jsx(ie,{className:"h-4 w-4 mr-2"}),"Cancel"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(S,{variant:"outline",onClick:L,disabled:g,children:[e.jsx(ds,{className:"h-4 w-4 mr-2"}),"Back"]}),e.jsxs(S,{onClick:v,disabled:u.length===0||g,children:[e.jsx(cs,{className:"h-4 w-4 mr-2"}),g?"Saving...":n?"Update Meal":"Add Meal"]})]})]})]})},T=(s,r)=>s.reduce((t,n)=>t+n.foods.reduce((a,o)=>a+o[r]*(o.quantity/100),0),0),Fs=({meal:s,className:r,onEdit:t,onDelete:n})=>{const[a,o]=i.useState(!1),c=T([s],"calories"),m=T([s],"protein"),u=s.time?new Date(s.time.toDate()).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"No time set",x=()=>o(h=>!h);return e.jsxs(I,{className:O("overflow-hidden",r),children:[e.jsx(B,{className:"py-3 px-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(Y,{className:"text-base capitalize flex items-center",children:[s.name,e.jsx(de,{variant:"outline",className:"ml-2 font-normal text-xs",children:u})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[t&&e.jsxs(S,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:()=>t(s),children:[e.jsx(xs,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Edit"})]}),n&&e.jsxs(S,{variant:"ghost",size:"sm",onClick:n,className:"h-8 w-8 p-0 text-destructive hover:text-destructive hover:bg-destructive/10",children:[e.jsx(Te,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Delete"})]}),e.jsxs(S,{variant:"ghost",size:"sm",onClick:x,className:"h-8 w-8 p-0 ml-1",children:[a?e.jsx(Ve,{className:"h-4 w-4"}):e.jsx(Xe,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:a?"Collapse":"Expand"})]})]})]})}),e.jsxs(M,{className:"px-4 pb-4 pt-0",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[e.jsxs("div",{className:"flex items-center text-muted-foreground",children:[e.jsx(hs,{className:"h-3.5 w-3.5 mr-1.5"}),e.jsx("span",{children:u})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("span",{className:"font-medium",children:[c," kcal"]}),e.jsxs("span",{className:"font-medium",children:[m,"g protein"]})]})]}),a&&s.foods.length>0&&e.jsx("div",{className:"pt-2 mt-2 border-t",children:e.jsx(Gs,{foods:s.foods})}),a&&s.foods.length===0&&e.jsx("div",{className:"py-3 text-center bg-muted/30 rounded-md mt-2",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"No food items in this meal"})}),!a&&s.foods.length>0&&e.jsxs(S,{variant:"ghost",size:"sm",onClick:x,className:"w-full mt-1 border border-dashed text-muted-foreground",children:["Show ",s.foods.length," food item",s.foods.length>1?"s":""]}),a&&s.foods.length>0&&e.jsx(S,{variant:"ghost",size:"sm",onClick:x,className:"w-full mt-1 border border-dashed text-muted-foreground",children:"Hide"})]})]})},Ds=({selectedDate:s,onDateChange:r})=>{const t=c=>{const m={weekday:"short",month:"short",day:"numeric"};return c.toLocaleDateString("en-US",m)},n=()=>{const c=new Date(s);c.setDate(s.getDate()-1),r(c)},a=()=>{const c=new Date(s);c.setDate(s.getDate()+1),r(c)},o=c=>{const m=new Date;return c.getDate()===m.getDate()&&c.getMonth()===m.getMonth()&&c.getFullYear()===m.getFullYear()};return e.jsx(I,{className:"mb-4 shadow-sm",children:e.jsx(M,{className:"p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(S,{variant:"ghost",size:"icon",onClick:n,"aria-label":"Previous day",children:e.jsx(Ke,{})}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"font-medium",children:t(s)}),o(s)&&e.jsx("span",{className:"text-xs text-primary",children:"Today"})]}),e.jsx(S,{variant:"ghost",size:"icon",onClick:a,"aria-label":"Next day",children:e.jsx(Qe,{})})]})})})},_s=({query:s,onQueryChange:r,onSearch:t,onClear:n,isLoading:a,onKeyDown:o,inputRef:c})=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Q,{ref:c,type:"text",placeholder:"Search for a food...",value:s,onChange:m=>r(m.target.value),onKeyDown:o,className:"pr-8"}),s&&e.jsx("button",{type:"button",onClick:n,className:"absolute right-2 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground transition-colors",children:e.jsx(ie,{className:"h-4 w-4"})})]}),e.jsxs(S,{type:"button",variant:"secondary",size:"sm",onClick:t,disabled:a||!s.trim()||s.trim().length<2,children:[a?e.jsx(ce,{className:"h-4 w-4 animate-spin"}):e.jsx(os,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Search"})]})]}),Ls=({food:s,onSelect:r,buttonLabel:t="Add"})=>{const n=me.extractNutrients(s);return e.jsx("div",{className:"p-3 hover:bg-accent/50 transition-colors",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1 cursor-pointer",onClick:()=>r(s),children:[e.jsx("h4",{className:"font-medium text-sm",children:s.description}),s.brandOwner&&e.jsx("p",{className:"text-xs text-muted-foreground truncate max-w-[90%]",children:s.brandOwner}),e.jsxs("div",{className:"flex flex-wrap gap-x-3 gap-y-1 mt-1 text-xs text-muted-foreground",children:[e.jsxs("span",{className:"font-medium text-foreground",children:[Math.round(n.calories)," cal"]}),e.jsxs("span",{children:["P: ",n.protein.toFixed(1),"g"]}),e.jsxs("span",{children:["C: ",n.carbs.toFixed(1),"g"]}),e.jsxs("span",{children:["F: ",n.fat.toFixed(1),"g"]})]})]}),e.jsxs(S,{size:"sm",variant:"ghost",onClick:()=>r(s),className:"h-7 px-2",children:[e.jsx(vs,{className:"h-3.5 w-3.5 mr-1"}),t]})]})})};function Is(s,r){return i.useReducer((t,n)=>r[t][n]??t,s)}var ue="ScrollArea",[Ae,lt]=Je(ue),[Ms,k]=Ae(ue),Ee=i.forwardRef((s,r)=>{const{__scopeScrollArea:t,type:n="hover",dir:a,scrollHideDelay:o=600,...c}=s,[m,u]=i.useState(null),[x,h]=i.useState(null),[l,d]=i.useState(null),[f,p]=i.useState(null),[w,g]=i.useState(null),[j,A]=i.useState(0),[D,E]=i.useState(0),[y,P]=i.useState(!1),[_,L]=i.useState(!1),v=K(r,b=>u(b)),N=Ge(a);return e.jsx(Ms,{scope:t,type:n,dir:N,scrollHideDelay:o,scrollArea:m,viewport:x,onViewportChange:h,content:l,onContentChange:d,scrollbarX:f,onScrollbarXChange:p,scrollbarXEnabled:y,onScrollbarXEnabledChange:P,scrollbarY:w,onScrollbarYChange:g,scrollbarYEnabled:_,onScrollbarYEnabledChange:L,onCornerWidthChange:A,onCornerHeightChange:E,children:e.jsx(J.div,{dir:N,...c,ref:v,style:{position:"relative","--radix-scroll-area-corner-width":j+"px","--radix-scroll-area-corner-height":D+"px",...s.style}})})});Ee.displayName=ue;var Re="ScrollAreaViewport",Fe=i.forwardRef((s,r)=>{const{__scopeScrollArea:t,children:n,nonce:a,...o}=s,c=k(Re,t),m=i.useRef(null),u=K(r,m,c.onViewportChange);return e.jsxs(e.Fragment,{children:[e.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:a}),e.jsx(J.div,{"data-radix-scroll-area-viewport":"",...o,ref:u,style:{overflowX:c.scrollbarXEnabled?"scroll":"hidden",overflowY:c.scrollbarYEnabled?"scroll":"hidden",...s.style},children:e.jsx("div",{ref:c.onContentChange,style:{minWidth:"100%",display:"table"},children:n})})]})});Fe.displayName=Re;var F="ScrollAreaScrollbar",he=i.forwardRef((s,r)=>{const{forceMount:t,...n}=s,a=k(F,s.__scopeScrollArea),{onScrollbarXEnabledChange:o,onScrollbarYEnabledChange:c}=a,m=s.orientation==="horizontal";return i.useEffect(()=>(m?o(!0):c(!0),()=>{m?o(!1):c(!1)}),[m,o,c]),a.type==="hover"?e.jsx(zs,{...n,ref:r,forceMount:t}):a.type==="scroll"?e.jsx(Os,{...n,ref:r,forceMount:t}):a.type==="auto"?e.jsx(De,{...n,ref:r,forceMount:t}):a.type==="always"?e.jsx(fe,{...n,ref:r}):null});he.displayName=F;var zs=i.forwardRef((s,r)=>{const{forceMount:t,...n}=s,a=k(F,s.__scopeScrollArea),[o,c]=i.useState(!1);return i.useEffect(()=>{const m=a.scrollArea;let u=0;if(m){const x=()=>{window.clearTimeout(u),c(!0)},h=()=>{u=window.setTimeout(()=>c(!1),a.scrollHideDelay)};return m.addEventListener("pointerenter",x),m.addEventListener("pointerleave",h),()=>{window.clearTimeout(u),m.removeEventListener("pointerenter",x),m.removeEventListener("pointerleave",h)}}},[a.scrollArea,a.scrollHideDelay]),e.jsx(se,{present:t||o,children:e.jsx(De,{"data-state":o?"visible":"hidden",...n,ref:r})})}),Os=i.forwardRef((s,r)=>{const{forceMount:t,...n}=s,a=k(F,s.__scopeScrollArea),o=s.orientation==="horizontal",c=re(()=>u("SCROLL_END"),100),[m,u]=Is("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return i.useEffect(()=>{if(m==="idle"){const x=window.setTimeout(()=>u("HIDE"),a.scrollHideDelay);return()=>window.clearTimeout(x)}},[m,a.scrollHideDelay,u]),i.useEffect(()=>{const x=a.viewport,h=o?"scrollLeft":"scrollTop";if(x){let l=x[h];const d=()=>{const f=x[h];l!==f&&(u("SCROLL"),c()),l=f};return x.addEventListener("scroll",d),()=>x.removeEventListener("scroll",d)}},[a.viewport,o,u,c]),e.jsx(se,{present:t||m!=="hidden",children:e.jsx(fe,{"data-state":m==="hidden"?"hidden":"visible",...n,ref:r,onPointerEnter:W(s.onPointerEnter,()=>u("POINTER_ENTER")),onPointerLeave:W(s.onPointerLeave,()=>u("POINTER_LEAVE"))})})}),De=i.forwardRef((s,r)=>{const t=k(F,s.__scopeScrollArea),{forceMount:n,...a}=s,[o,c]=i.useState(!1),m=s.orientation==="horizontal",u=re(()=>{if(t.viewport){const x=t.viewport.offsetWidth<t.viewport.scrollWidth,h=t.viewport.offsetHeight<t.viewport.scrollHeight;c(m?x:h)}},10);return X(t.viewport,u),X(t.content,u),e.jsx(se,{present:n||o,children:e.jsx(fe,{"data-state":o?"visible":"hidden",...a,ref:r})})}),fe=i.forwardRef((s,r)=>{const{orientation:t="vertical",...n}=s,a=k(F,s.__scopeScrollArea),o=i.useRef(null),c=i.useRef(0),[m,u]=i.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),x=ze(m.viewport,m.content),h={...n,sizes:m,onSizesChange:u,hasThumb:x>0&&x<1,onThumbChange:d=>o.current=d,onThumbPointerUp:()=>c.current=0,onThumbPointerDown:d=>c.current=d};function l(d,f){return Bs(d,c.current,m,f)}return t==="horizontal"?e.jsx(Hs,{...h,ref:r,onThumbPositionChange:()=>{if(a.viewport&&o.current){const d=a.viewport.scrollLeft,f=ge(d,m,a.dir);o.current.style.transform=`translate3d(${f}px, 0, 0)`}},onWheelScroll:d=>{a.viewport&&(a.viewport.scrollLeft=d)},onDragScroll:d=>{a.viewport&&(a.viewport.scrollLeft=l(d,a.dir))}}):t==="vertical"?e.jsx(qs,{...h,ref:r,onThumbPositionChange:()=>{if(a.viewport&&o.current){const d=a.viewport.scrollTop,f=ge(d,m);o.current.style.transform=`translate3d(0, ${f}px, 0)`}},onWheelScroll:d=>{a.viewport&&(a.viewport.scrollTop=d)},onDragScroll:d=>{a.viewport&&(a.viewport.scrollTop=l(d))}}):null}),Hs=i.forwardRef((s,r)=>{const{sizes:t,onSizesChange:n,...a}=s,o=k(F,s.__scopeScrollArea),[c,m]=i.useState(),u=i.useRef(null),x=K(r,u,o.onScrollbarXChange);return i.useEffect(()=>{u.current&&m(getComputedStyle(u.current))},[u]),e.jsx(Le,{"data-orientation":"horizontal",...a,ref:x,sizes:t,style:{bottom:0,left:o.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:o.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":te(t)+"px",...s.style},onThumbPointerDown:h=>s.onThumbPointerDown(h.x),onDragScroll:h=>s.onDragScroll(h.x),onWheelScroll:(h,l)=>{if(o.viewport){const d=o.viewport.scrollLeft+h.deltaX;s.onWheelScroll(d),He(d,l)&&h.preventDefault()}},onResize:()=>{u.current&&o.viewport&&c&&n({content:o.viewport.scrollWidth,viewport:o.viewport.offsetWidth,scrollbar:{size:u.current.clientWidth,paddingStart:ee(c.paddingLeft),paddingEnd:ee(c.paddingRight)}})}})}),qs=i.forwardRef((s,r)=>{const{sizes:t,onSizesChange:n,...a}=s,o=k(F,s.__scopeScrollArea),[c,m]=i.useState(),u=i.useRef(null),x=K(r,u,o.onScrollbarYChange);return i.useEffect(()=>{u.current&&m(getComputedStyle(u.current))},[u]),e.jsx(Le,{"data-orientation":"vertical",...a,ref:x,sizes:t,style:{top:0,right:o.dir==="ltr"?0:void 0,left:o.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":te(t)+"px",...s.style},onThumbPointerDown:h=>s.onThumbPointerDown(h.y),onDragScroll:h=>s.onDragScroll(h.y),onWheelScroll:(h,l)=>{if(o.viewport){const d=o.viewport.scrollTop+h.deltaY;s.onWheelScroll(d),He(d,l)&&h.preventDefault()}},onResize:()=>{u.current&&o.viewport&&c&&n({content:o.viewport.scrollHeight,viewport:o.viewport.offsetHeight,scrollbar:{size:u.current.clientHeight,paddingStart:ee(c.paddingTop),paddingEnd:ee(c.paddingBottom)}})}})}),[$s,_e]=Ae(F),Le=i.forwardRef((s,r)=>{const{__scopeScrollArea:t,sizes:n,hasThumb:a,onThumbChange:o,onThumbPointerUp:c,onThumbPointerDown:m,onThumbPositionChange:u,onDragScroll:x,onWheelScroll:h,onResize:l,...d}=s,f=k(F,t),[p,w]=i.useState(null),g=K(r,v=>w(v)),j=i.useRef(null),A=i.useRef(""),D=f.viewport,E=n.content-n.viewport,y=$(h),P=$(u),_=re(l,10);function L(v){if(j.current){const N=v.clientX-j.current.left,b=v.clientY-j.current.top;x({x:N,y:b})}}return i.useEffect(()=>{const v=N=>{const b=N.target;(p==null?void 0:p.contains(b))&&y(N,E)};return document.addEventListener("wheel",v,{passive:!1}),()=>document.removeEventListener("wheel",v,{passive:!1})},[D,p,E,y]),i.useEffect(P,[n,P]),X(p,_),X(f.content,_),e.jsx($s,{scope:t,scrollbar:p,hasThumb:a,onThumbChange:$(o),onThumbPointerUp:$(c),onThumbPositionChange:P,onThumbPointerDown:$(m),children:e.jsx(J.div,{...d,ref:g,style:{position:"absolute",...d.style},onPointerDown:W(s.onPointerDown,v=>{v.button===0&&(v.target.setPointerCapture(v.pointerId),j.current=p.getBoundingClientRect(),A.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",f.viewport&&(f.viewport.style.scrollBehavior="auto"),L(v))}),onPointerMove:W(s.onPointerMove,L),onPointerUp:W(s.onPointerUp,v=>{const N=v.target;N.hasPointerCapture(v.pointerId)&&N.releasePointerCapture(v.pointerId),document.body.style.webkitUserSelect=A.current,f.viewport&&(f.viewport.style.scrollBehavior=""),j.current=null})})})}),V="ScrollAreaThumb",Ie=i.forwardRef((s,r)=>{const{forceMount:t,...n}=s,a=_e(V,s.__scopeScrollArea);return e.jsx(se,{present:t||a.hasThumb,children:e.jsx(Ws,{ref:r,...n})})}),Ws=i.forwardRef((s,r)=>{const{__scopeScrollArea:t,style:n,...a}=s,o=k(V,t),c=_e(V,t),{onThumbPositionChange:m}=c,u=K(r,l=>c.onThumbChange(l)),x=i.useRef(void 0),h=re(()=>{x.current&&(x.current(),x.current=void 0)},100);return i.useEffect(()=>{const l=o.viewport;if(l){const d=()=>{if(h(),!x.current){const f=Ys(l,m);x.current=f,m()}};return m(),l.addEventListener("scroll",d),()=>l.removeEventListener("scroll",d)}},[o.viewport,h,m]),e.jsx(J.div,{"data-state":c.hasThumb?"visible":"hidden",...a,ref:u,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...n},onPointerDownCapture:W(s.onPointerDownCapture,l=>{const f=l.target.getBoundingClientRect(),p=l.clientX-f.left,w=l.clientY-f.top;c.onThumbPointerDown({x:p,y:w})}),onPointerUp:W(s.onPointerUp,c.onThumbPointerUp)})});Ie.displayName=V;var xe="ScrollAreaCorner",Me=i.forwardRef((s,r)=>{const t=k(xe,s.__scopeScrollArea),n=!!(t.scrollbarX&&t.scrollbarY);return t.type!=="scroll"&&n?e.jsx(Us,{...s,ref:r}):null});Me.displayName=xe;var Us=i.forwardRef((s,r)=>{const{__scopeScrollArea:t,...n}=s,a=k(xe,t),[o,c]=i.useState(0),[m,u]=i.useState(0),x=!!(o&&m);return X(a.scrollbarX,()=>{var l;const h=((l=a.scrollbarX)==null?void 0:l.offsetHeight)||0;a.onCornerHeightChange(h),u(h)}),X(a.scrollbarY,()=>{var l;const h=((l=a.scrollbarY)==null?void 0:l.offsetWidth)||0;a.onCornerWidthChange(h),c(h)}),x?e.jsx(J.div,{...n,ref:r,style:{width:o,height:m,position:"absolute",right:a.dir==="ltr"?0:void 0,left:a.dir==="rtl"?0:void 0,bottom:0,...s.style}}):null});function ee(s){return s?parseInt(s,10):0}function ze(s,r){const t=s/r;return isNaN(t)?0:t}function te(s){const r=ze(s.viewport,s.content),t=s.scrollbar.paddingStart+s.scrollbar.paddingEnd,n=(s.scrollbar.size-t)*r;return Math.max(n,18)}function Bs(s,r,t,n="ltr"){const a=te(t),o=a/2,c=r||o,m=a-c,u=t.scrollbar.paddingStart+c,x=t.scrollbar.size-t.scrollbar.paddingEnd-m,h=t.content-t.viewport,l=n==="ltr"?[0,h]:[h*-1,0];return Oe([u,x],l)(s)}function ge(s,r,t="ltr"){const n=te(r),a=r.scrollbar.paddingStart+r.scrollbar.paddingEnd,o=r.scrollbar.size-a,c=r.content-r.viewport,m=o-n,u=t==="ltr"?[0,c]:[c*-1,0],x=es(s,u);return Oe([0,c],[0,m])(x)}function Oe(s,r){return t=>{if(s[0]===s[1]||r[0]===r[1])return r[0];const n=(r[1]-r[0])/(s[1]-s[0]);return r[0]+n*(t-s[0])}}function He(s,r){return s>0&&s<r}var Ys=(s,r=()=>{})=>{let t={left:s.scrollLeft,top:s.scrollTop},n=0;return function a(){const o={left:s.scrollLeft,top:s.scrollTop},c=t.left!==o.left,m=t.top!==o.top;(c||m)&&r(),t=o,n=window.requestAnimationFrame(a)}(),()=>window.cancelAnimationFrame(n)};function re(s,r){const t=$(s),n=i.useRef(0);return i.useEffect(()=>()=>window.clearTimeout(n.current),[]),i.useCallback(()=>{window.clearTimeout(n.current),n.current=window.setTimeout(t,r)},[t,r])}function X(s,r){const t=$(r);Ze(()=>{let n=0;if(s){const a=new ResizeObserver(()=>{cancelAnimationFrame(n),n=window.requestAnimationFrame(t)});return a.observe(s),()=>{window.cancelAnimationFrame(n),a.unobserve(s)}}},[s,t])}var qe=Ee,Xs=Fe,Ks=Me;const $e=i.forwardRef(({className:s,children:r,...t},n)=>e.jsxs(qe,{ref:n,className:O("relative overflow-hidden",s),...t,children:[e.jsx(Xs,{className:"h-full w-full rounded-[inherit]",children:r}),e.jsx(We,{}),e.jsx(Ks,{})]}));$e.displayName=qe.displayName;const We=i.forwardRef(({className:s,orientation:r="vertical",...t},n)=>e.jsx(he,{ref:n,orientation:r,className:O("flex touch-none select-none transition-colors",r==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",r==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",s),...t,children:e.jsx(Ie,{className:"relative flex-1 rounded-full bg-border"})}));We.displayName=he.displayName;const Ue=i.forwardRef(({isLoading:s,error:r,results:t,onSelectFood:n,buttonLabel:a="Add",showInline:o=!1,className:c=""},m)=>e.jsx(I,{ref:m,className:`${o?"":"absolute z-50 left-0 right-0 top-[calc(100%+0.5rem)]"} shadow-md ${c}`,children:e.jsx(M,{className:"p-0 overflow-hidden",children:s?e.jsxs("div",{className:"flex items-center justify-center p-4 text-sm text-muted-foreground",children:[e.jsx(ce,{className:"h-4 w-4 mr-2 animate-spin"}),"Searching..."]}):r?e.jsx("div",{className:"p-4 text-sm text-destructive",children:r}):t.length>0?e.jsx($e,{className:"max-h-64 overflow-y-scroll",children:t.map(u=>e.jsx(Ls,{food:u,onSelect:n,buttonLabel:a},u.fdcId))}):null})}));Ue.displayName="FoodSearchResults";const Qs=({onSelectFood:s,buttonLabel:r="Add",autoFocus:t=!1,showInline:n=!1})=>{const[a,o]=i.useState(""),[c,m]=i.useState([]),[u,x]=i.useState(!1),[h,l]=i.useState(null),[d,f]=i.useState(!1),p=i.useRef(null),w=i.useRef(null),g=ls(a,300);i.useEffect(()=>{function y(P){p.current&&!p.current.contains(P.target)&&w.current!==P.target&&f(!1)}return document.addEventListener("mousedown",y),()=>document.removeEventListener("mousedown",y)},[]),i.useEffect(()=>{t&&w.current&&w.current.focus()},[t]);const j=i.useCallback(async()=>{if(!(!a.trim()||a.trim().length<2)){x(!0),l(null),f(!0);try{const y=await me.searchFoods(a);m(y),y.length===0&&l("No foods found matching your search.")}catch(y){l("Failed to search foods. Please try again."),console.error(y)}finally{x(!1)}}},[a]),A=()=>{o(""),m([]),l(null),f(!1),w.current&&w.current.focus()},D=y=>{f(!1),s(y),n?(m([]),l(null)):A()},E=y=>{y.key==="Enter"&&a.trim()?(y.preventDefault(),j()):y.key==="Escape"&&f(!1)};return i.useEffect(()=>{g.trim().length>=2&&j()},[g,j]),e.jsxs("div",{className:"relative w-full",children:[e.jsx(_s,{inputRef:w,query:a,onQueryChange:o,onSearch:j,onClear:A,isLoading:u,onKeyDown:E}),d&&e.jsx(Ue,{ref:p,isLoading:u,error:h,results:c,onSelectFood:D,buttonLabel:r,showInline:n})]})},U=({children:s,errorMessage:r,className:t})=>e.jsxs("div",{className:O("space-y-2",t),children:[s,r&&e.jsxs("div",{className:"flex items-center gap-1 text-destructive text-xs",children:[e.jsx(G,{className:"h-3 w-3"}),e.jsx("span",{children:r})]})]}),Gs=({foods:s,className:r=""})=>!s||s.length===0?null:e.jsx("div",{className:`space-y-2 ${r}`,children:s.map((t,n)=>e.jsx("div",{className:"bg-background border rounded-md p-3",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium text-sm",children:t.name}),e.jsxs("div",{className:"flex flex-wrap gap-x-3 gap-y-1 mt-1 text-xs text-muted-foreground",children:[e.jsxs("span",{children:[t.quantity," ",t.unit]}),e.jsxs("span",{children:[t.calories," calories"]}),e.jsxs("span",{children:[t.protein,"g protein"]})]})]}),e.jsx(de,{variant:"outline",className:"text-xs",children:n+1})]})},`food-${n}`))}),Js=({meals:s,onDeleteMeal:r,onEditMeal:t,onAddMeal:n,isLoading:a=!1,children:o})=>e.jsxs(I,{className:"w-full",children:[e.jsxs(B,{className:"pb-3 flex flex-row items-center justify-between",children:[e.jsxs(Y,{className:"text-lg flex items-center gap-2",children:[e.jsx(ke,{className:"h-5 w-5"}),a&&e.jsx(ce,{className:"h-4 w-4 ml-2 animate-spin text-muted-foreground"})]}),n&&e.jsxs(S,{variant:"outline",size:"sm",onClick:n,className:"h-8 gap-1",children:[e.jsx(Pe,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:"Add Meal"})]})]}),e.jsxs(M,{className:"space-y-3",children:[a?e.jsx("div",{className:"space-y-4 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:Array(3).fill(0).map((m,u)=>e.jsx(I,{className:"h-[180px] overflow-hidden",children:e.jsxs("div",{className:"p-4 h-full flex flex-col",children:[e.jsx(R,{className:"h-5 w-3/4 mb-2"}),e.jsx(R,{className:"h-4 w-1/2 mb-4"}),e.jsxs("div",{className:"flex space-x-2 mb-3",children:[e.jsx(R,{className:"h-4 w-16"}),e.jsx(R,{className:"h-4 w-16"})]}),e.jsx("div",{className:"flex-1"}),e.jsxs("div",{className:"flex justify-between items-center pt-2 mt-auto",children:[e.jsx(R,{className:"h-4 w-16"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(R,{className:"h-8 w-8 rounded-md"}),e.jsx(R,{className:"h-8 w-8 rounded-md"})]})]})]})},`skeleton-${u}`))}):s.length>0?e.jsx("div",{className:"space-y-4 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:s.map((m,u)=>e.jsx(Fs,{meal:m,onDelete:()=>r(u),onEdit:()=>t(u,m),className:"h-full"},`meal-${m.id||u}`))}):e.jsx("div",{className:"py-8 text-center border-dashed border rounded-md bg-muted/40",children:e.jsx("p",{className:"text-muted-foreground",children:"No meals logged."})}),o&&e.jsx("div",{className:"pt-3",children:o})]})]});function Zs({className:s,...r}){return e.jsx("textarea",{"data-slot":"textarea",className:O("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),...r})}const Vs=({notes:s,isLoading:r=!1,onChange:t})=>{const[n,a]=Z.useState(s),[o,c]=Z.useState(!1),[m,u]=Z.useState(!1);Z.useEffect(()=>{a(s)},[s]);const x=()=>{a(s),c(!0)},h=()=>{a(s),c(!1)},l=async()=>{u(!0);try{await t(n),c(!1)}catch(d){console.error("Failed to save notes:",d)}finally{u(!1)}};return r?e.jsxs(I,{children:[e.jsx(B,{children:e.jsxs(Y,{className:"flex items-center justify-between",children:[e.jsx(R,{className:"h-4 w-16"}),e.jsx(R,{className:"w-20"})]})}),e.jsx(M,{children:e.jsx(R,{className:"w-full"})})]}):e.jsxs(I,{children:[e.jsx(B,{children:e.jsxs(Y,{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Notes"}),!o&&e.jsxs(S,{variant:"outline",size:"sm",onClick:x,children:[e.jsx(oe,{className:"mr-2"}),s?"Edit":"Add Notes"]})]})}),e.jsx(M,{children:o?e.jsx(Zs,{value:n,onChange:d=>a(d.target.value),placeholder:"Add your notes here...",className:"resize-none"}):e.jsx("div",{children:s?e.jsx("p",{className:"whitespace-pre-wrap",children:s}):e.jsx("p",{className:"text-muted-foreground italic",children:"No notes added yet."})})}),o&&e.jsxs(le,{className:"flex justify-end gap-2",children:[e.jsxs(S,{variant:"ghost",size:"sm",onClick:h,disabled:m,children:[e.jsx(ie,{className:"mr-1"}),"Cancel"]}),e.jsxs(S,{variant:"default",size:"sm",onClick:l,disabled:m,children:[e.jsx(gs,{className:"mr-1"}),m?"Saving...":"Save"]})]})]})},et=({nutritionEntry:s,onEntryUpdated:r})=>{const[t,n]=i.useState(!1),[a,o]=i.useState(null),c=i.useCallback(async l=>{const d={calories:T([l],"calories"),protein:T([l],"protein"),carbs:T([l],"carbs"),fat:T([l],"fat")};try{const f=await rs({meals:[l],dailyTotals:d});if(!f)return o("Failed to create nutrition entry"),!1;const p=await as(f);return p?(r(p),!0):(o("Failed to fetch new nutrition entry"),!1)}catch(f){return console.error("Error creating nutrition entry:",f),o("Failed to create new nutrition entry"),!1}},[r]),m=i.useCallback(async l=>{if(!s||!s.id)return o("Missing nutrition entry"),!1;const d=[...s.meals||[],l],f={calories:T(d,"calories"),protein:T(d,"protein"),carbs:T(d,"carbs"),fat:T(d,"fat")};if(!await ne(s.id,{meals:d,dailyTotals:f}))return o("Failed to add meal to existing entry"),!1;const w={...s,meals:d,dailyTotals:f};return r(w),!0},[s,r]),u=i.useCallback(async l=>{n(!0),o(null);try{return s!=null&&s.id?await m(l):await c(l)}catch(d){return console.error("Error in addMeal operation:",d),o("An error occurred while processing the meal"),!1}finally{n(!1)}},[s,c,m]),x=i.useCallback(async(l,d)=>{if(!(s!=null&&s.id)||!s.meals)return o("Cannot edit meal: No nutrition entry or meals exist"),!1;if(l<0||l>=s.meals.length)return o("Invalid meal index"),!1;n(!0),o(null);try{const f=[...s.meals];f[l]=d;const p={calories:T(f,"calories"),protein:T(f,"protein"),carbs:T(f,"carbs"),fat:T(f,"fat")};if(await ne(s.id,{meals:f,dailyTotals:p})){const g={...s,meals:f,dailyTotals:p};return r(g),!0}return o("Failed to update meal"),!1}catch(f){return console.error("Error editing meal:",f),o("An error occurred while editing the meal"),!1}finally{n(!1)}},[s,r]),h=i.useCallback(async l=>{if(!(s!=null&&s.id)||!s.meals)return o("Cannot delete meal: No nutrition entry or meals exist"),!1;if(l<0||l>=s.meals.length)return o("Invalid meal index"),!1;n(!0),o(null);try{const d=s.meals.filter((w,g)=>g!==l),f={calories:T(d,"calories"),protein:T(d,"protein"),carbs:T(d,"carbs"),fat:T(d,"fat")};if(await ne(s.id,{meals:d,dailyTotals:f})){const w={...s,meals:d,dailyTotals:f};return r(w),!0}return o("Failed to delete meal"),!1}catch(d){return console.error("Error deleting meal:",d),o("An error occurred while deleting the meal"),!1}finally{n(!1)}},[s,r]);return{addMeal:u,editMeal:x,deleteMeal:h,isLoading:t,error:a}},ct=()=>{const[s,r]=i.useState(new Date),[t,n]=i.useState("hidden"),[a,o]=i.useState(void 0),[c,m]=i.useState(-1),{selectedDateNutritionEntries:u,isLoading:x,refreshData:h,updateNotes:l}=ns(s),d=u[0],{addMeal:f,editMeal:p,deleteMeal:w,isLoading:g}=et({nutritionEntry:d,onEntryUpdated:v=>{v?h(v):h()}}),j=x||g,A=i.useCallback(v=>{r(v),n("hidden"),o(void 0)},[]),D=()=>{n("add"),o(void 0),m(-1)},E=async(v,N)=>(o(N),m(v),n("edit"),Promise.resolve()),y=async v=>{try{let N=!1;t==="add"?N=await f(v):t==="edit"&&c!==-1&&(N=await p(c,v)),N&&(n("hidden"),o(void 0),m(-1))}catch(N){console.error("Error handling meal submission:",N)}},P=()=>{n("hidden"),o(void 0),m(-1)},_=t!=="hidden",L=(d==null?void 0:d.meals)||[];return e.jsxs("div",{className:"nutrition-page space-y-4",children:[e.jsx("div",{className:"container mx-auto px-4 max-w-md",children:e.jsx(Ds,{selectedDate:s,onDateChange:A})}),e.jsx("div",{className:_?"container mx-auto px-4 max-w-md":"container mx-auto px-4",children:_?e.jsx(Rs,{onSubmit:y,onCancel:P,initialMeal:a,isEditing:t==="edit"}):e.jsx(e.Fragment,{children:e.jsx(Js,{meals:L,onEditMeal:E,onDeleteMeal:async v=>{await w(v)},onAddMeal:D,isLoading:j})})}),e.jsx("div",{className:"container mx-auto px-4 max-w-md pb-8",children:e.jsx(Vs,{notes:(d==null?void 0:d.notes)||"",onChange:v=>l((d==null?void 0:d.id)||"",v),isLoading:j})})]})};export{ct as Nutrition};
