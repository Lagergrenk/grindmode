import{c as z,j as e,g as X,h as H,I as Q,r as i,T as je,C as I,a as U,b as B,d as M,i as le,B as S,k as ce,l as Be,m as Ye,n as Xe,L as ie,o as K,p as Ke,q as Qe,P as J,s as se,t as $,v as q,w as Ge,S as R,R as Z}from"./index-BVhBuUdI.js";import{S as we,a as Ne,b as Se,c as ye,d as Ce,C as Je,e as Ze}from"./select-CJsF-iq6.js";import{a as Ve,b as es,c as ss,g as ts,d as oe,u as rs}from"./useNutritionEntry-D0RBBiQl.js";import{T as Te,X as de,S as as,u as os}from"./useDebounce-Cflizi1q.js";import{C as Pe}from"./circle-plus-B9qqM8_E.js";import{C as ns}from"./check-y5HSpqRI.js";/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ls=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],cs=z("arrow-left",ls);/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const is=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],G=z("circle-alert",is);/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ds=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]],ms=z("clock",ds);/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hs=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],us=z("pen",hs);/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fs=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],xs=z("plus",fs);/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ps=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],bs=z("save",ps);/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vs=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],ne=z("square-pen",vs);/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gs=[["path",{d:"M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2",key:"cjf0a3"}],["path",{d:"M7 2v20",key:"1473qp"}],["path",{d:"M21 15V2a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7",key:"j28e5"}]],ke=z("utensils",gs),js=({message:s,className:r})=>s?e.jsxs("div",{className:X("flex items-center gap-2 text-destructive text-sm",r),children:[e.jsx(G,{className:"h-4 w-4"}),e.jsx("span",{children:s})]}):null,ws=[{value:"breakfast",label:"Breakfast"},{value:"lunch",label:"Lunch"},{value:"dinner",label:"Dinner"},{value:"snack",label:"Snack"},{value:"other",label:"Other"}],Ns=({name:s,time:r,onNameChange:t,onTimeChange:o})=>e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs(W,{children:[e.jsx(H,{htmlFor:"meal-name",children:"Meal Type"}),e.jsxs(we,{value:s,onValueChange:t,children:[e.jsx(Ne,{id:"meal-name",className:"max-w-[180px]",children:e.jsx(Se,{placeholder:"Select meal type"})}),e.jsx(ye,{children:ws.map(a=>e.jsx(Ce,{value:a.value,children:a.label},a.value))})]})]}),e.jsxs(W,{children:[e.jsx(H,{htmlFor:"meal-time",children:"Time"}),e.jsx(Q,{id:"meal-time",type:"time",value:r,onChange:o,className:"max-w-[180px]"})]})]}),Ss=({onSubmit:s,onCancel:r,initialMeal:t,isEditing:o=!1})=>{const[a,n]=i.useState((t==null?void 0:t.name)||""),[c,m]=i.useState((t==null?void 0:t.time)||je.now()),[h,x]=i.useState({mealName:""}),[u,l]=i.useState(!1),d=()=>{const g={mealName:""};let j=!0;return a||(g.mealName="Meal type is required",j=!1),x(g),j},f=async g=>{if(g.preventDefault(),!!d())try{l(!0),await s({name:a,time:c})}catch(j){console.error("Error submitting meal form:",j)}finally{l(!1)}},p=g=>{n(g),g&&x(j=>({...j,mealName:""}))},w=g=>{m(es(g.target.value))};return e.jsxs(I,{className:"w-full",children:[e.jsx(U,{children:e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(ke,{className:"h-5 w-5"}),o?"Edit Meal":"Add New Meal"]})}),e.jsxs("form",{onSubmit:f,children:[e.jsxs(M,{className:"space-y-4",children:[e.jsx(Ns,{name:a,time:Ve(c),onNameChange:p,onTimeChange:w}),h.mealName&&e.jsx(js,{message:h.mealName})]}),e.jsxs(le,{className:"flex justify-end gap-2 border-t pt-4 mt-1",children:[e.jsx(S,{type:"button",variant:"outline",onClick:r,disabled:u,children:"Cancel"}),e.jsx(S,{type:"submit",disabled:u,children:u?"Saving...":o?"Save Changes":"Save Meal"})]})]})]})},ys=s=>{const r={name:"",quantity:"",calories:"",protein:"",carbs:"",fat:""};let t=!0;return s.name.trim()||(r.name="Food name is required",t=!1),s.quantity<=0&&(r.quantity="Quantity must be greater than 0",t=!1),s.calories<0&&(r.calories="Calories cannot be negative",t=!1),s.protein<0&&(r.protein="Protein cannot be negative",t=!1),s.carbs<0&&(r.carbs="Carbs cannot be negative",t=!1),s.fat<0&&(r.fat="Fat cannot be negative",t=!1),{isValid:t,newErrors:r}},be="aGILeRnIJ3bHhfVWbBagI6fbyRwqbzDGOf5x1FB3",ve="https://api.nal.usda.gov/fdc/v1",O={calories:1008,protein:1003,carbs:1005,fat:1004,fiber:1079,sugar:2e3,sodium:1093},me={searchFoods:async(s,r=20)=>{try{const t=await fetch(`${ve}/foods/search?api_key=${be}&query=${encodeURIComponent(s)}&pageSize=${r}`);if(!t.ok)throw new Error(`USDA API error: ${t.status}`);return(await t.json()).foods||[]}catch(t){throw console.error("Error searching foods:",t),t}},getFoodDetails:async s=>{try{const r=await fetch(`${ve}/food/${s}?api_key=${be}`);if(!r.ok)throw new Error(`USDA API error: ${r.status}`);return await r.json()}catch(r){throw console.error(`Error getting food details for ID ${s}:`,r),r}},extractNutrients:s=>{const r={calories:0,protein:0,carbs:0,fat:0,fiber:0,sugar:0,sodium:0};return s.foodNutrients.forEach(t=>{switch(t.nutrientId){case O.calories:r.calories=t.value;break;case O.protein:r.protein=t.value;break;case O.carbs:r.carbs=t.value;break;case O.fat:r.fat=t.value;break;case O.fiber:r.fiber=t.value;break;case O.sugar:r.sugar=t.value;break;case O.sodium:r.sodium=t.value;break}}),r}},Cs=[{value:"g",label:"grams (g)"},{value:"ml",label:"milliliters (ml)"}],Ts=[{id:"calories",label:"Calories",placeholder:"165",unit:""},{id:"protein",label:"Protein",placeholder:"31",unit:"g"},{id:"carbs",label:"Carbs",placeholder:"0",unit:"g"},{id:"fat",label:"Fat",placeholder:"3.6",unit:"g"}],Ps=({onSubmit:s,onCancel:r,initValues:t})=>{const[o,a]=i.useState({name:(t==null?void 0:t.name)||"",quantity:(t==null?void 0:t.quantity)||100,calories:(t==null?void 0:t.calories)||0,protein:(t==null?void 0:t.protein)||0,carbs:(t==null?void 0:t.carbs)||0,fat:(t==null?void 0:t.fat)||0,unit:(t==null?void 0:t.unit)||"g"}),[n,c]=i.useState({name:"",quantity:"",calories:"",protein:"",carbs:"",fat:""}),m=l=>{const d=me.extractNutrients(l);a({...o,name:l.description,quantity:100,calories:Math.round(d.calories||0),protein:Math.round(d.protein||0),carbs:Math.round(d.carbs||0),fat:Math.round(d.fat||0)}),c({name:"",quantity:"",calories:"",protein:"",carbs:"",fat:""})},h=l=>{const{id:d,value:f}=l.target,p=d.replace("food-",""),g=["quantity","calories","protein","carbs","fat"].includes(p)?parseFloat(f)||0:f;a(j=>({...j,[p]:g})),n[p]&&c(j=>({...j,[p]:""}))},x=l=>{a(d=>({...d,unit:l}))},u=l=>{l.preventDefault();const d=ys(o);c(d.newErrors),d.isValid&&s(o)};return e.jsxs("form",{onSubmit:u,className:"space-y-4",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx(H,{className:"text-sm font-medium block mb-2",children:"Search USDA Food Database"}),e.jsx(Ys,{onSelectFood:m,buttonLabel:"Select",autoFocus:!t}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Search for foods to automatically fill nutrition information"})]}),e.jsxs(W,{children:[e.jsx(H,{htmlFor:"food-name",className:"text-sm font-medium",children:"Food Name"}),e.jsx(Q,{id:"food-name",placeholder:"e.g., Chicken Breast",value:o.name,onChange:h,className:n.name?"border-destructive":""}),n.name&&e.jsxs("div",{className:"flex items-center mt-1 text-destructive text-xs",children:[e.jsx(G,{className:"h-3 w-3 mr-1"}),e.jsx("span",{children:n.name})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs(W,{children:[e.jsx(H,{htmlFor:"food-quantity",className:"text-sm font-medium",children:"Quantity"}),e.jsx(Q,{id:"food-quantity",type:"number",placeholder:"100",value:o.quantity===0?"":o.quantity,onChange:h,min:"0",step:"any",className:n.quantity?"border-destructive":""}),n.quantity&&e.jsxs("div",{className:"flex items-center mt-1 text-destructive text-xs",children:[e.jsx(G,{className:"h-3 w-3 mr-1"}),e.jsx("span",{children:n.quantity})]})]}),e.jsxs(W,{children:[e.jsx(H,{htmlFor:"food-unit",className:"text-sm font-medium",children:"Unit"}),e.jsxs(we,{value:o.unit,onValueChange:x,children:[e.jsx(Ne,{id:"food-unit",children:e.jsx(Se,{placeholder:"Select unit"})}),e.jsx(ye,{children:Cs.map(l=>e.jsx(Ce,{value:l.value,children:l.label},l.value))})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium mb-2",children:"Nutrition Information"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:Ts.map(l=>e.jsxs(W,{children:[e.jsxs(H,{htmlFor:`food-${l.id}`,className:"text-sm font-medium",children:[l.label,l.unit?` (${l.unit})`:""]}),e.jsx(Q,{id:`food-${l.id}`,type:"number",placeholder:l.placeholder,value:o[l.id]===0?"":o[l.id],onChange:h,min:"0",step:"any",className:n[l.id]?"border-destructive":""}),n[l.id]&&e.jsxs("div",{className:"flex items-center mt-1 text-destructive text-xs",children:[e.jsx(G,{className:"h-3 w-3 mr-1"}),e.jsx("span",{children:n[l.id]})]})]},l.id))})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx(S,{type:"button",variant:"outline",size:"sm",onClick:r,children:"Cancel"}),e.jsxs(S,{type:"submit",size:"sm",children:[t?"Update":"Add"," Food Item"]})]})]})},ks=({onSubmit:s,onCancel:r,initialMeal:t,isEditing:o=!1})=>{const[a,n]=i.useState("meal"),[c,m]=i.useState({name:(t==null?void 0:t.name)||"",time:(t==null?void 0:t.time)||je.now()}),[h,x]=i.useState((t==null?void 0:t.foods)||[]),[u,l]=i.useState(!1),[d,f]=i.useState(null),[p,w]=i.useState(null),[g,j]=i.useState(!1),A=async v=>{m(v),n("food")},D=()=>{l(!0),f(null),w(null)},E=v=>{l(!0),f(h[v]),w(v)},y=v=>{x(C=>C.filter((pe,ae)=>ae!==v))},P=v=>{x(p!==null?C=>C.map((pe,ae)=>ae===p?v:pe):C=>[...C,v]),l(!1),f(null),w(null)},_=()=>{l(!1),f(null),w(null)},L=()=>{n("meal")},b=async()=>{if(!(!c||h.length===0)){j(!0);try{const v={id:(t==null?void 0:t.id)||`meal-${Date.now()}`,name:c.name,time:c.time,foods:h};await s(v)}catch(v){console.error("Error submitting meal:",v)}finally{j(!1)}}},N=h.reduce((v,C)=>(v.calories+=C.calories*C.quantity/100,v.protein+=C.protein*C.quantity/100,v.carbs+=C.carbs*C.quantity/100,v.fat+=C.fat*C.quantity/100,v),{calories:0,protein:0,carbs:0,fat:0});return e.jsxs(I,{className:"w-full",children:[e.jsx(U,{children:e.jsxs(B,{children:[o?"Edit Meal":"Add New Meal",a==="food"&&e.jsxs(ce,{className:"ml-2",children:[h.length," items"]})]})}),e.jsx(M,{children:a==="meal"?e.jsx(Ss,{onSubmit:A,onCancel:r,initialMeal:c,isEditing:o}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-muted p-3 rounded-md flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium capitalize",children:c.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(c.time.toMillis()).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),e.jsxs(S,{variant:"outline",size:"sm",onClick:L,children:[e.jsx(ne,{className:"h-4 w-4 mr-2"}),"Edit"]})]}),u?e.jsx("div",{className:"border rounded-lg p-4",children:e.jsx(Ps,{onSubmit:P,onCancel:_,initValues:d||void 0})}):e.jsxs("div",{className:"space-y-3",children:[h.length>0&&e.jsxs("div",{className:"space-y-2",children:[h.map((v,C)=>e.jsxs("div",{className:"border rounded-lg p-3 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:v.name}),e.jsxs("div",{className:"flex gap-3 text-sm text-muted-foreground",children:[e.jsxs("span",{children:[v.quantity," ",v.unit]}),e.jsxs("span",{children:[v.calories," kcal"]}),e.jsxs("span",{children:[v.protein,"g protein"]})]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(S,{variant:"ghost",size:"sm",onClick:()=>E(C),className:"h-8 w-8 p-0",children:e.jsx(ne,{className:"h-4 w-4"})}),e.jsx(S,{variant:"ghost",size:"sm",onClick:()=>y(C),className:"h-8 w-8 p-0 text-destructive hover:bg-destructive/10",children:e.jsx(Te,{className:"h-4 w-4"})})]})]},C)),e.jsxs("div",{className:"bg-secondary/40 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium text-sm",children:"Total calories:"}),e.jsxs("span",{className:"font-medium text-sm",children:[N.calories," kcal"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium text-sm",children:"Total protein:"}),e.jsxs("span",{className:"font-medium text-sm",children:[N.protein,"g"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium text-sm",children:"Total carbs:"}),e.jsxs("span",{className:"font-medium text-sm",children:[N.carbs,"g"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium text-sm",children:"Total fat:"}),e.jsxs("span",{className:"font-medium text-sm",children:[N.fat,"g"]})]})]})]}),e.jsxs(S,{variant:"outline",className:"w-full",onClick:D,children:[e.jsx(Pe,{className:"h-4 w-4 mr-2"}),h.length?"Add Another Food":"Add Food Item"]})]})]})}),a==="food"&&!u&&e.jsxs(le,{className:"border-t pt-4 flex justify-between",children:[e.jsxs(S,{variant:"ghost",onClick:r,disabled:g,children:[e.jsx(de,{className:"h-4 w-4 mr-2"}),"Cancel"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(S,{variant:"outline",onClick:L,disabled:g,children:[e.jsx(cs,{className:"h-4 w-4 mr-2"}),"Back"]}),e.jsxs(S,{onClick:b,disabled:h.length===0||g,children:[e.jsx(ns,{className:"h-4 w-4 mr-2"}),g?"Saving...":o?"Update Meal":"Add Meal"]})]})]})]})},T=(s,r)=>s.reduce((t,o)=>t+o.foods.reduce((a,n)=>a+n[r]*(n.quantity/100),0),0),As=({meal:s,className:r,onEdit:t,onDelete:o})=>{const[a,n]=i.useState(!1),c=T([s],"calories"),m=T([s],"protein"),h=s.time?new Date(s.time.toDate()).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"No time set",x=()=>n(u=>!u);return e.jsxs(I,{className:X("overflow-hidden",r),children:[e.jsx(U,{className:"py-3 px-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(B,{className:"text-base capitalize flex items-center",children:[s.name,e.jsx(ce,{variant:"outline",className:"ml-2 font-normal text-xs",children:h})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[t&&e.jsxs(S,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:()=>t(s),children:[e.jsx(us,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Edit"})]}),o&&e.jsxs(S,{variant:"ghost",size:"sm",onClick:o,className:"h-8 w-8 p-0 text-destructive hover:text-destructive hover:bg-destructive/10",children:[e.jsx(Te,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Delete"})]}),e.jsxs(S,{variant:"ghost",size:"sm",onClick:x,className:"h-8 w-8 p-0 ml-1",children:[a?e.jsx(Je,{className:"h-4 w-4"}):e.jsx(Be,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:a?"Collapse":"Expand"})]})]})]})}),e.jsxs(M,{className:"px-4 pb-4 pt-0",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[e.jsxs("div",{className:"flex items-center text-muted-foreground",children:[e.jsx(ms,{className:"h-3.5 w-3.5 mr-1.5"}),e.jsx("span",{children:h})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("span",{className:"font-medium",children:[c," kcal"]}),e.jsxs("span",{className:"font-medium",children:[m,"g protein"]})]})]}),a&&s.foods.length>0&&e.jsx("div",{className:"pt-2 mt-2 border-t",children:e.jsx(Xs,{foods:s.foods})}),a&&s.foods.length===0&&e.jsx("div",{className:"py-3 text-center bg-muted/30 rounded-md mt-2",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"No food items in this meal"})}),!a&&s.foods.length>0&&e.jsxs(S,{variant:"ghost",size:"sm",onClick:x,className:"w-full mt-1 border border-dashed text-muted-foreground",children:["Show ",s.foods.length," food item",s.foods.length>1?"s":""]}),a&&s.foods.length>0&&e.jsx(S,{variant:"ghost",size:"sm",onClick:x,className:"w-full mt-1 border border-dashed text-muted-foreground",children:"Hide"})]})]})},Es=({selectedDate:s,onDateChange:r})=>{const t=c=>{const m={weekday:"short",month:"short",day:"numeric"};return c.toLocaleDateString("en-US",m)},o=()=>{const c=new Date(s);c.setDate(s.getDate()-1),r(c)},a=()=>{const c=new Date(s);c.setDate(s.getDate()+1),r(c)},n=c=>{const m=new Date;return c.getDate()===m.getDate()&&c.getMonth()===m.getMonth()&&c.getFullYear()===m.getFullYear()};return e.jsx(I,{className:"mb-4 shadow-sm",children:e.jsx(M,{className:"p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(S,{variant:"ghost",size:"icon",onClick:o,"aria-label":"Previous day",children:e.jsx(Ye,{})}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"font-medium",children:t(s)}),n(s)&&e.jsx("span",{className:"text-xs text-primary",children:"Today"})]}),e.jsx(S,{variant:"ghost",size:"icon",onClick:a,"aria-label":"Next day",children:e.jsx(Xe,{})})]})})})},Rs=({query:s,onQueryChange:r,onSearch:t,onClear:o,isLoading:a,onKeyDown:n,inputRef:c})=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Q,{ref:c,type:"text",placeholder:"Search for a food...",value:s,onChange:m=>r(m.target.value),onKeyDown:n,className:"pr-8"}),s&&e.jsx("button",{type:"button",onClick:o,className:"absolute right-2 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground transition-colors",children:e.jsx(de,{className:"h-4 w-4"})})]}),e.jsxs(S,{type:"button",variant:"secondary",size:"sm",onClick:t,disabled:a||!s.trim()||s.trim().length<2,children:[a?e.jsx(ie,{className:"h-4 w-4 animate-spin"}):e.jsx(as,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Search"})]})]}),Fs=({food:s,onSelect:r,buttonLabel:t="Add"})=>{const o=me.extractNutrients(s);return e.jsx("div",{className:"p-3 hover:bg-accent/50 transition-colors",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1 cursor-pointer",onClick:()=>r(s),children:[e.jsx("h4",{className:"font-medium text-sm",children:s.description}),s.brandOwner&&e.jsx("p",{className:"text-xs text-muted-foreground truncate max-w-[90%]",children:s.brandOwner}),e.jsxs("div",{className:"flex flex-wrap gap-x-3 gap-y-1 mt-1 text-xs text-muted-foreground",children:[e.jsxs("span",{className:"font-medium text-foreground",children:[Math.round(o.calories)," cal"]}),e.jsxs("span",{children:["P: ",o.protein.toFixed(1),"g"]}),e.jsxs("span",{children:["C: ",o.carbs.toFixed(1),"g"]}),e.jsxs("span",{children:["F: ",o.fat.toFixed(1),"g"]})]})]}),e.jsxs(S,{size:"sm",variant:"ghost",onClick:()=>r(s),className:"h-7 px-2",children:[e.jsx(xs,{className:"h-3.5 w-3.5 mr-1"}),t]})]})})};function Ds(s,r){return i.useReducer((t,o)=>r[t][o]??t,s)}var he="ScrollArea",[Ae,at]=Qe(he),[_s,k]=Ae(he),Ee=i.forwardRef((s,r)=>{const{__scopeScrollArea:t,type:o="hover",dir:a,scrollHideDelay:n=600,...c}=s,[m,h]=i.useState(null),[x,u]=i.useState(null),[l,d]=i.useState(null),[f,p]=i.useState(null),[w,g]=i.useState(null),[j,A]=i.useState(0),[D,E]=i.useState(0),[y,P]=i.useState(!1),[_,L]=i.useState(!1),b=K(r,v=>h(v)),N=Ke(a);return e.jsx(_s,{scope:t,type:o,dir:N,scrollHideDelay:n,scrollArea:m,viewport:x,onViewportChange:u,content:l,onContentChange:d,scrollbarX:f,onScrollbarXChange:p,scrollbarXEnabled:y,onScrollbarXEnabledChange:P,scrollbarY:w,onScrollbarYChange:g,scrollbarYEnabled:_,onScrollbarYEnabledChange:L,onCornerWidthChange:A,onCornerHeightChange:E,children:e.jsx(J.div,{dir:N,...c,ref:b,style:{position:"relative","--radix-scroll-area-corner-width":j+"px","--radix-scroll-area-corner-height":D+"px",...s.style}})})});Ee.displayName=he;var Re="ScrollAreaViewport",Fe=i.forwardRef((s,r)=>{const{__scopeScrollArea:t,children:o,nonce:a,...n}=s,c=k(Re,t),m=i.useRef(null),h=K(r,m,c.onViewportChange);return e.jsxs(e.Fragment,{children:[e.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:a}),e.jsx(J.div,{"data-radix-scroll-area-viewport":"",...n,ref:h,style:{overflowX:c.scrollbarXEnabled?"scroll":"hidden",overflowY:c.scrollbarYEnabled?"scroll":"hidden",...s.style},children:e.jsx("div",{ref:c.onContentChange,style:{minWidth:"100%",display:"table"},children:o})})]})});Fe.displayName=Re;var F="ScrollAreaScrollbar",ue=i.forwardRef((s,r)=>{const{forceMount:t,...o}=s,a=k(F,s.__scopeScrollArea),{onScrollbarXEnabledChange:n,onScrollbarYEnabledChange:c}=a,m=s.orientation==="horizontal";return i.useEffect(()=>(m?n(!0):c(!0),()=>{m?n(!1):c(!1)}),[m,n,c]),a.type==="hover"?e.jsx(Ls,{...o,ref:r,forceMount:t}):a.type==="scroll"?e.jsx(Is,{...o,ref:r,forceMount:t}):a.type==="auto"?e.jsx(De,{...o,ref:r,forceMount:t}):a.type==="always"?e.jsx(fe,{...o,ref:r}):null});ue.displayName=F;var Ls=i.forwardRef((s,r)=>{const{forceMount:t,...o}=s,a=k(F,s.__scopeScrollArea),[n,c]=i.useState(!1);return i.useEffect(()=>{const m=a.scrollArea;let h=0;if(m){const x=()=>{window.clearTimeout(h),c(!0)},u=()=>{h=window.setTimeout(()=>c(!1),a.scrollHideDelay)};return m.addEventListener("pointerenter",x),m.addEventListener("pointerleave",u),()=>{window.clearTimeout(h),m.removeEventListener("pointerenter",x),m.removeEventListener("pointerleave",u)}}},[a.scrollArea,a.scrollHideDelay]),e.jsx(se,{present:t||n,children:e.jsx(De,{"data-state":n?"visible":"hidden",...o,ref:r})})}),Is=i.forwardRef((s,r)=>{const{forceMount:t,...o}=s,a=k(F,s.__scopeScrollArea),n=s.orientation==="horizontal",c=re(()=>h("SCROLL_END"),100),[m,h]=Ds("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return i.useEffect(()=>{if(m==="idle"){const x=window.setTimeout(()=>h("HIDE"),a.scrollHideDelay);return()=>window.clearTimeout(x)}},[m,a.scrollHideDelay,h]),i.useEffect(()=>{const x=a.viewport,u=n?"scrollLeft":"scrollTop";if(x){let l=x[u];const d=()=>{const f=x[u];l!==f&&(h("SCROLL"),c()),l=f};return x.addEventListener("scroll",d),()=>x.removeEventListener("scroll",d)}},[a.viewport,n,h,c]),e.jsx(se,{present:t||m!=="hidden",children:e.jsx(fe,{"data-state":m==="hidden"?"hidden":"visible",...o,ref:r,onPointerEnter:$(s.onPointerEnter,()=>h("POINTER_ENTER")),onPointerLeave:$(s.onPointerLeave,()=>h("POINTER_LEAVE"))})})}),De=i.forwardRef((s,r)=>{const t=k(F,s.__scopeScrollArea),{forceMount:o,...a}=s,[n,c]=i.useState(!1),m=s.orientation==="horizontal",h=re(()=>{if(t.viewport){const x=t.viewport.offsetWidth<t.viewport.scrollWidth,u=t.viewport.offsetHeight<t.viewport.scrollHeight;c(m?x:u)}},10);return Y(t.viewport,h),Y(t.content,h),e.jsx(se,{present:o||n,children:e.jsx(fe,{"data-state":n?"visible":"hidden",...a,ref:r})})}),fe=i.forwardRef((s,r)=>{const{orientation:t="vertical",...o}=s,a=k(F,s.__scopeScrollArea),n=i.useRef(null),c=i.useRef(0),[m,h]=i.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),x=ze(m.viewport,m.content),u={...o,sizes:m,onSizesChange:h,hasThumb:x>0&&x<1,onThumbChange:d=>n.current=d,onThumbPointerUp:()=>c.current=0,onThumbPointerDown:d=>c.current=d};function l(d,f){return $s(d,c.current,m,f)}return t==="horizontal"?e.jsx(Ms,{...u,ref:r,onThumbPositionChange:()=>{if(a.viewport&&n.current){const d=a.viewport.scrollLeft,f=ge(d,m,a.dir);n.current.style.transform=`translate3d(${f}px, 0, 0)`}},onWheelScroll:d=>{a.viewport&&(a.viewport.scrollLeft=d)},onDragScroll:d=>{a.viewport&&(a.viewport.scrollLeft=l(d,a.dir))}}):t==="vertical"?e.jsx(zs,{...u,ref:r,onThumbPositionChange:()=>{if(a.viewport&&n.current){const d=a.viewport.scrollTop,f=ge(d,m);n.current.style.transform=`translate3d(0, ${f}px, 0)`}},onWheelScroll:d=>{a.viewport&&(a.viewport.scrollTop=d)},onDragScroll:d=>{a.viewport&&(a.viewport.scrollTop=l(d))}}):null}),Ms=i.forwardRef((s,r)=>{const{sizes:t,onSizesChange:o,...a}=s,n=k(F,s.__scopeScrollArea),[c,m]=i.useState(),h=i.useRef(null),x=K(r,h,n.onScrollbarXChange);return i.useEffect(()=>{h.current&&m(getComputedStyle(h.current))},[h]),e.jsx(Le,{"data-orientation":"horizontal",...a,ref:x,sizes:t,style:{bottom:0,left:n.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:n.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":te(t)+"px",...s.style},onThumbPointerDown:u=>s.onThumbPointerDown(u.x),onDragScroll:u=>s.onDragScroll(u.x),onWheelScroll:(u,l)=>{if(n.viewport){const d=n.viewport.scrollLeft+u.deltaX;s.onWheelScroll(d),He(d,l)&&u.preventDefault()}},onResize:()=>{h.current&&n.viewport&&c&&o({content:n.viewport.scrollWidth,viewport:n.viewport.offsetWidth,scrollbar:{size:h.current.clientWidth,paddingStart:ee(c.paddingLeft),paddingEnd:ee(c.paddingRight)}})}})}),zs=i.forwardRef((s,r)=>{const{sizes:t,onSizesChange:o,...a}=s,n=k(F,s.__scopeScrollArea),[c,m]=i.useState(),h=i.useRef(null),x=K(r,h,n.onScrollbarYChange);return i.useEffect(()=>{h.current&&m(getComputedStyle(h.current))},[h]),e.jsx(Le,{"data-orientation":"vertical",...a,ref:x,sizes:t,style:{top:0,right:n.dir==="ltr"?0:void 0,left:n.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":te(t)+"px",...s.style},onThumbPointerDown:u=>s.onThumbPointerDown(u.y),onDragScroll:u=>s.onDragScroll(u.y),onWheelScroll:(u,l)=>{if(n.viewport){const d=n.viewport.scrollTop+u.deltaY;s.onWheelScroll(d),He(d,l)&&u.preventDefault()}},onResize:()=>{h.current&&n.viewport&&c&&o({content:n.viewport.scrollHeight,viewport:n.viewport.offsetHeight,scrollbar:{size:h.current.clientHeight,paddingStart:ee(c.paddingTop),paddingEnd:ee(c.paddingBottom)}})}})}),[Os,_e]=Ae(F),Le=i.forwardRef((s,r)=>{const{__scopeScrollArea:t,sizes:o,hasThumb:a,onThumbChange:n,onThumbPointerUp:c,onThumbPointerDown:m,onThumbPositionChange:h,onDragScroll:x,onWheelScroll:u,onResize:l,...d}=s,f=k(F,t),[p,w]=i.useState(null),g=K(r,b=>w(b)),j=i.useRef(null),A=i.useRef(""),D=f.viewport,E=o.content-o.viewport,y=q(u),P=q(h),_=re(l,10);function L(b){if(j.current){const N=b.clientX-j.current.left,v=b.clientY-j.current.top;x({x:N,y:v})}}return i.useEffect(()=>{const b=N=>{const v=N.target;(p==null?void 0:p.contains(v))&&y(N,E)};return document.addEventListener("wheel",b,{passive:!1}),()=>document.removeEventListener("wheel",b,{passive:!1})},[D,p,E,y]),i.useEffect(P,[o,P]),Y(p,_),Y(f.content,_),e.jsx(Os,{scope:t,scrollbar:p,hasThumb:a,onThumbChange:q(n),onThumbPointerUp:q(c),onThumbPositionChange:P,onThumbPointerDown:q(m),children:e.jsx(J.div,{...d,ref:g,style:{position:"absolute",...d.style},onPointerDown:$(s.onPointerDown,b=>{b.button===0&&(b.target.setPointerCapture(b.pointerId),j.current=p.getBoundingClientRect(),A.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",f.viewport&&(f.viewport.style.scrollBehavior="auto"),L(b))}),onPointerMove:$(s.onPointerMove,L),onPointerUp:$(s.onPointerUp,b=>{const N=b.target;N.hasPointerCapture(b.pointerId)&&N.releasePointerCapture(b.pointerId),document.body.style.webkitUserSelect=A.current,f.viewport&&(f.viewport.style.scrollBehavior=""),j.current=null})})})}),V="ScrollAreaThumb",Ie=i.forwardRef((s,r)=>{const{forceMount:t,...o}=s,a=_e(V,s.__scopeScrollArea);return e.jsx(se,{present:t||a.hasThumb,children:e.jsx(Hs,{ref:r,...o})})}),Hs=i.forwardRef((s,r)=>{const{__scopeScrollArea:t,style:o,...a}=s,n=k(V,t),c=_e(V,t),{onThumbPositionChange:m}=c,h=K(r,l=>c.onThumbChange(l)),x=i.useRef(void 0),u=re(()=>{x.current&&(x.current(),x.current=void 0)},100);return i.useEffect(()=>{const l=n.viewport;if(l){const d=()=>{if(u(),!x.current){const f=Ws(l,m);x.current=f,m()}};return m(),l.addEventListener("scroll",d),()=>l.removeEventListener("scroll",d)}},[n.viewport,u,m]),e.jsx(J.div,{"data-state":c.hasThumb?"visible":"hidden",...a,ref:h,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...o},onPointerDownCapture:$(s.onPointerDownCapture,l=>{const f=l.target.getBoundingClientRect(),p=l.clientX-f.left,w=l.clientY-f.top;c.onThumbPointerDown({x:p,y:w})}),onPointerUp:$(s.onPointerUp,c.onThumbPointerUp)})});Ie.displayName=V;var xe="ScrollAreaCorner",Me=i.forwardRef((s,r)=>{const t=k(xe,s.__scopeScrollArea),o=!!(t.scrollbarX&&t.scrollbarY);return t.type!=="scroll"&&o?e.jsx(qs,{...s,ref:r}):null});Me.displayName=xe;var qs=i.forwardRef((s,r)=>{const{__scopeScrollArea:t,...o}=s,a=k(xe,t),[n,c]=i.useState(0),[m,h]=i.useState(0),x=!!(n&&m);return Y(a.scrollbarX,()=>{var l;const u=((l=a.scrollbarX)==null?void 0:l.offsetHeight)||0;a.onCornerHeightChange(u),h(u)}),Y(a.scrollbarY,()=>{var l;const u=((l=a.scrollbarY)==null?void 0:l.offsetWidth)||0;a.onCornerWidthChange(u),c(u)}),x?e.jsx(J.div,{...o,ref:r,style:{width:n,height:m,position:"absolute",right:a.dir==="ltr"?0:void 0,left:a.dir==="rtl"?0:void 0,bottom:0,...s.style}}):null});function ee(s){return s?parseInt(s,10):0}function ze(s,r){const t=s/r;return isNaN(t)?0:t}function te(s){const r=ze(s.viewport,s.content),t=s.scrollbar.paddingStart+s.scrollbar.paddingEnd,o=(s.scrollbar.size-t)*r;return Math.max(o,18)}function $s(s,r,t,o="ltr"){const a=te(t),n=a/2,c=r||n,m=a-c,h=t.scrollbar.paddingStart+c,x=t.scrollbar.size-t.scrollbar.paddingEnd-m,u=t.content-t.viewport,l=o==="ltr"?[0,u]:[u*-1,0];return Oe([h,x],l)(s)}function ge(s,r,t="ltr"){const o=te(r),a=r.scrollbar.paddingStart+r.scrollbar.paddingEnd,n=r.scrollbar.size-a,c=r.content-r.viewport,m=n-o,h=t==="ltr"?[0,c]:[c*-1,0],x=Ze(s,h);return Oe([0,c],[0,m])(x)}function Oe(s,r){return t=>{if(s[0]===s[1]||r[0]===r[1])return r[0];const o=(r[1]-r[0])/(s[1]-s[0]);return r[0]+o*(t-s[0])}}function He(s,r){return s>0&&s<r}var Ws=(s,r=()=>{})=>{let t={left:s.scrollLeft,top:s.scrollTop},o=0;return function a(){const n={left:s.scrollLeft,top:s.scrollTop},c=t.left!==n.left,m=t.top!==n.top;(c||m)&&r(),t=n,o=window.requestAnimationFrame(a)}(),()=>window.cancelAnimationFrame(o)};function re(s,r){const t=q(s),o=i.useRef(0);return i.useEffect(()=>()=>window.clearTimeout(o.current),[]),i.useCallback(()=>{window.clearTimeout(o.current),o.current=window.setTimeout(t,r)},[t,r])}function Y(s,r){const t=q(r);Ge(()=>{let o=0;if(s){const a=new ResizeObserver(()=>{cancelAnimationFrame(o),o=window.requestAnimationFrame(t)});return a.observe(s),()=>{window.cancelAnimationFrame(o),a.unobserve(s)}}},[s,t])}var qe=Ee,Us=Fe,Bs=Me;const $e=i.forwardRef(({className:s,children:r,...t},o)=>e.jsxs(qe,{ref:o,className:X("relative overflow-hidden",s),...t,children:[e.jsx(Us,{className:"h-full w-full rounded-[inherit]",children:r}),e.jsx(We,{}),e.jsx(Bs,{})]}));$e.displayName=qe.displayName;const We=i.forwardRef(({className:s,orientation:r="vertical",...t},o)=>e.jsx(ue,{ref:o,orientation:r,className:X("flex touch-none select-none transition-colors",r==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",r==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",s),...t,children:e.jsx(Ie,{className:"relative flex-1 rounded-full bg-border"})}));We.displayName=ue.displayName;const Ue=i.forwardRef(({isLoading:s,error:r,results:t,onSelectFood:o,buttonLabel:a="Add",showInline:n=!1,className:c=""},m)=>e.jsx(I,{ref:m,className:`${n?"":"absolute z-50 left-0 right-0 top-[calc(100%+0.5rem)]"} shadow-md ${c}`,children:e.jsx(M,{className:"p-0 overflow-hidden",children:s?e.jsxs("div",{className:"flex items-center justify-center p-4 text-sm text-muted-foreground",children:[e.jsx(ie,{className:"h-4 w-4 mr-2 animate-spin"}),"Searching..."]}):r?e.jsx("div",{className:"p-4 text-sm text-destructive",children:r}):t.length>0?e.jsx($e,{className:"max-h-64 overflow-y-scroll",children:t.map(h=>e.jsx(Fs,{food:h,onSelect:o,buttonLabel:a},h.fdcId))}):null})}));Ue.displayName="FoodSearchResults";const Ys=({onSelectFood:s,buttonLabel:r="Add",autoFocus:t=!1,showInline:o=!1})=>{const[a,n]=i.useState(""),[c,m]=i.useState([]),[h,x]=i.useState(!1),[u,l]=i.useState(null),[d,f]=i.useState(!1),p=i.useRef(null),w=i.useRef(null),g=os(a,300);i.useEffect(()=>{function y(P){p.current&&!p.current.contains(P.target)&&w.current!==P.target&&f(!1)}return document.addEventListener("mousedown",y),()=>document.removeEventListener("mousedown",y)},[]),i.useEffect(()=>{t&&w.current&&w.current.focus()},[t]);const j=i.useCallback(async()=>{if(!(!a.trim()||a.trim().length<2)){x(!0),l(null),f(!0);try{const y=await me.searchFoods(a);m(y),y.length===0&&l("No foods found matching your search.")}catch(y){l("Failed to search foods. Please try again."),console.error(y)}finally{x(!1)}}},[a]),A=()=>{n(""),m([]),l(null),f(!1),w.current&&w.current.focus()},D=y=>{f(!1),s(y),o?(m([]),l(null)):A()},E=y=>{y.key==="Enter"&&a.trim()?(y.preventDefault(),j()):y.key==="Escape"&&f(!1)};return i.useEffect(()=>{g.trim().length>=2&&j()},[g,j]),e.jsxs("div",{className:"relative w-full",children:[e.jsx(Rs,{inputRef:w,query:a,onQueryChange:n,onSearch:j,onClear:A,isLoading:h,onKeyDown:E}),d&&e.jsx(Ue,{ref:p,isLoading:h,error:u,results:c,onSelectFood:D,buttonLabel:r,showInline:o})]})},W=({children:s,errorMessage:r,className:t})=>e.jsxs("div",{className:X("space-y-2",t),children:[s,r&&e.jsxs("div",{className:"flex items-center gap-1 text-destructive text-xs",children:[e.jsx(G,{className:"h-3 w-3"}),e.jsx("span",{children:r})]})]}),Xs=({foods:s,className:r=""})=>!s||s.length===0?null:e.jsx("div",{className:`space-y-2 ${r}`,children:s.map((t,o)=>e.jsx("div",{className:"bg-background border rounded-md p-3",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium text-sm",children:t.name}),e.jsxs("div",{className:"flex flex-wrap gap-x-3 gap-y-1 mt-1 text-xs text-muted-foreground",children:[e.jsxs("span",{children:[t.quantity," ",t.unit]}),e.jsxs("span",{children:[t.calories," calories"]}),e.jsxs("span",{children:[t.protein,"g protein"]})]})]}),e.jsx(ce,{variant:"outline",className:"text-xs",children:o+1})]})},`food-${o}`))}),Ks=({meals:s,onDeleteMeal:r,onEditMeal:t,onAddMeal:o,isLoading:a=!1,children:n})=>e.jsxs(I,{className:"w-full",children:[e.jsxs(U,{className:"pb-3 flex flex-row items-center justify-between",children:[e.jsxs(B,{className:"text-lg flex items-center gap-2",children:[e.jsx(ke,{className:"h-5 w-5"}),a&&e.jsx(ie,{className:"h-4 w-4 ml-2 animate-spin text-muted-foreground"})]}),o&&e.jsxs(S,{variant:"outline",size:"sm",onClick:o,className:"h-8 gap-1",children:[e.jsx(Pe,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:"Add Meal"})]})]}),e.jsxs(M,{className:"space-y-3",children:[a?e.jsx("div",{className:"space-y-4 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:Array(3).fill(0).map((m,h)=>e.jsx(I,{className:"h-[180px] overflow-hidden",children:e.jsxs("div",{className:"p-4 h-full flex flex-col",children:[e.jsx(R,{className:"h-5 w-3/4 mb-2"}),e.jsx(R,{className:"h-4 w-1/2 mb-4"}),e.jsxs("div",{className:"flex space-x-2 mb-3",children:[e.jsx(R,{className:"h-4 w-16"}),e.jsx(R,{className:"h-4 w-16"})]}),e.jsx("div",{className:"flex-1"}),e.jsxs("div",{className:"flex justify-between items-center pt-2 mt-auto",children:[e.jsx(R,{className:"h-4 w-16"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(R,{className:"h-8 w-8 rounded-md"}),e.jsx(R,{className:"h-8 w-8 rounded-md"})]})]})]})},`skeleton-${h}`))}):s.length>0?e.jsx("div",{className:"space-y-4 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:s.map((m,h)=>e.jsx(As,{meal:m,onDelete:()=>r(h),onEdit:()=>t(h,m),className:"h-full"},`meal-${m.id||h}`))}):e.jsx("div",{className:"py-8 text-center border-dashed border rounded-md bg-muted/40",children:e.jsx("p",{className:"text-muted-foreground",children:"No meals logged."})}),n&&e.jsx("div",{className:"pt-3",children:n})]})]});function Qs({className:s,...r}){return e.jsx("textarea",{"data-slot":"textarea",className:X("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),...r})}const Gs=({notes:s,isLoading:r=!1,onChange:t})=>{const[o,a]=Z.useState(s),[n,c]=Z.useState(!1),[m,h]=Z.useState(!1);Z.useEffect(()=>{a(s)},[s]);const x=()=>{a(s),c(!0)},u=()=>{a(s),c(!1)},l=async()=>{h(!0);try{await t(o),c(!1)}catch(d){console.error("Failed to save notes:",d)}finally{h(!1)}};return r?e.jsxs(I,{children:[e.jsx(U,{children:e.jsxs(B,{className:"flex items-center justify-between",children:[e.jsx(R,{className:"h-4 w-16"}),e.jsx(R,{className:"w-20"})]})}),e.jsx(M,{children:e.jsx(R,{className:"w-full"})})]}):e.jsxs(I,{children:[e.jsx(U,{children:e.jsxs(B,{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Notes"}),!n&&e.jsxs(S,{variant:"outline",size:"sm",onClick:x,children:[e.jsx(ne,{className:"mr-2"}),s?"Edit":"Add Notes"]})]})}),e.jsx(M,{children:n?e.jsx(Qs,{value:o,onChange:d=>a(d.target.value),placeholder:"Add your notes here...",className:"resize-none"}):e.jsx("div",{children:s?e.jsx("p",{className:"whitespace-pre-wrap",children:s}):e.jsx("p",{className:"text-muted-foreground italic",children:"No notes added yet."})})}),n&&e.jsxs(le,{className:"flex justify-end gap-2",children:[e.jsxs(S,{variant:"ghost",size:"sm",onClick:u,disabled:m,children:[e.jsx(de,{className:"mr-1"}),"Cancel"]}),e.jsxs(S,{variant:"default",size:"sm",onClick:l,disabled:m,children:[e.jsx(bs,{className:"mr-1"}),m?"Saving...":"Save"]})]})]})},Js=({nutritionEntry:s,onEntryUpdated:r})=>{const[t,o]=i.useState(!1),[a,n]=i.useState(null),c=i.useCallback(async l=>{const d={calories:T([l],"calories"),protein:T([l],"protein"),carbs:T([l],"carbs"),fat:T([l],"fat")};try{const f=await ss({meals:[l],dailyTotals:d});if(!f)return n("Failed to create nutrition entry"),!1;const p=await ts(f);return p?(r(p),!0):(n("Failed to fetch new nutrition entry"),!1)}catch(f){return console.error("Error creating nutrition entry:",f),n("Failed to create new nutrition entry"),!1}},[r]),m=i.useCallback(async l=>{if(!s||!s.id)return n("Missing nutrition entry"),!1;const d=[...s.meals||[],l],f={calories:T(d,"calories"),protein:T(d,"protein"),carbs:T(d,"carbs"),fat:T(d,"fat")};if(!await oe(s.id,{meals:d,dailyTotals:f}))return n("Failed to add meal to existing entry"),!1;const w={...s,meals:d,dailyTotals:f};return r(w),!0},[s,r]),h=i.useCallback(async l=>{o(!0),n(null);try{return s!=null&&s.id?await m(l):await c(l)}catch(d){return console.error("Error in addMeal operation:",d),n("An error occurred while processing the meal"),!1}finally{o(!1)}},[s,c,m]),x=i.useCallback(async(l,d)=>{if(!(s!=null&&s.id)||!s.meals)return n("Cannot edit meal: No nutrition entry or meals exist"),!1;if(l<0||l>=s.meals.length)return n("Invalid meal index"),!1;o(!0),n(null);try{const f=[...s.meals];f[l]=d;const p={calories:T(f,"calories"),protein:T(f,"protein"),carbs:T(f,"carbs"),fat:T(f,"fat")};if(await oe(s.id,{meals:f,dailyTotals:p})){const g={...s,meals:f,dailyTotals:p};return r(g),!0}return n("Failed to update meal"),!1}catch(f){return console.error("Error editing meal:",f),n("An error occurred while editing the meal"),!1}finally{o(!1)}},[s,r]),u=i.useCallback(async l=>{if(!(s!=null&&s.id)||!s.meals)return n("Cannot delete meal: No nutrition entry or meals exist"),!1;if(l<0||l>=s.meals.length)return n("Invalid meal index"),!1;o(!0),n(null);try{const d=s.meals.filter((w,g)=>g!==l),f={calories:T(d,"calories"),protein:T(d,"protein"),carbs:T(d,"carbs"),fat:T(d,"fat")};if(await oe(s.id,{meals:d,dailyTotals:f})){const w={...s,meals:d,dailyTotals:f};return r(w),!0}return n("Failed to delete meal"),!1}catch(d){return console.error("Error deleting meal:",d),n("An error occurred while deleting the meal"),!1}finally{o(!1)}},[s,r]);return{addMeal:h,editMeal:x,deleteMeal:u,isLoading:t,error:a}},ot=()=>{const[s,r]=i.useState(new Date),[t,o]=i.useState("hidden"),[a,n]=i.useState(void 0),[c,m]=i.useState(-1),{selectedDateNutritionEntries:h,isLoading:x,refreshData:u,updateNotes:l}=rs(s),d=h[0],{addMeal:f,editMeal:p,deleteMeal:w,isLoading:g}=Js({nutritionEntry:d,onEntryUpdated:b=>{b?u(b):u()}}),j=x||g,A=i.useCallback(b=>{r(b),o("hidden"),n(void 0)},[]),D=()=>{o("add"),n(void 0),m(-1)},E=async(b,N)=>(n(N),m(b),o("edit"),Promise.resolve()),y=async b=>{try{let N=!1;t==="add"?N=await f(b):t==="edit"&&c!==-1&&(N=await p(c,b)),N&&(o("hidden"),n(void 0),m(-1))}catch(N){console.error("Error handling meal submission:",N)}},P=()=>{o("hidden"),n(void 0),m(-1)},_=t!=="hidden",L=(d==null?void 0:d.meals)||[];return e.jsxs("div",{className:"nutrition-page space-y-4",children:[e.jsx("div",{className:"container mx-auto px-4 max-w-md",children:e.jsx(Es,{selectedDate:s,onDateChange:A})}),e.jsx("div",{className:_?"container mx-auto px-4 max-w-md":"container mx-auto px-4",children:_?e.jsx(ks,{onSubmit:y,onCancel:P,initialMeal:a,isEditing:t==="edit"}):e.jsx(e.Fragment,{children:e.jsx(Ks,{meals:L,onEditMeal:E,onDeleteMeal:async b=>{await w(b)},onAddMeal:D,isLoading:j})})}),e.jsx("div",{className:"container mx-auto px-4 max-w-md pb-8",children:e.jsx(Gs,{notes:(d==null?void 0:d.notes)||"",onChange:b=>l((d==null?void 0:d.id)||"",b),isLoading:j})})]})};export{ot as Nutrition};
//# sourceMappingURL=Nutrition-IeEu_hg2.js.map
